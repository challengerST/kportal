(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
/**
 * Created by Auser on 2016/12/6.
 */
"use strict";
var Data = (function () {
    var getName = function (data, callback) {
        var _data = {};
        $.ajax({
            url: '/api/airline/manage/getName'
            , type: 'post'
            , data: data
            , dataType: 'json'
            , timeout: 100000
            , success: function (json) {
                if (json && "resCode" in json) {
                    _data = json;
                } else {
                    _data = {};
                }
            }, complete: function () {
                if (callback && callback instanceof Function) {
                    callback(_data);
                }
            }
        });
    };
    var getCode = function (data, callback) {
        var _data = {};
        $.ajax({
            url: '/api/airline/manage/getCode'
            , type: 'post'
            , data: data
            , dataType: 'json'
            , timeout: 100000
            , success: function (json) {
                if (json && "resCode" in json) {
                    _data = json;
                } else {
                    _data = {};
                }
            }, complete: function () {
                if (callback && callback instanceof Function) {
                    callback(_data);
                }
            }
        });
    };
    var priceList = function (callback) {
        var _data = {};
        $.ajax({
            url: '/api/airline/price/list'
            , type: 'post'
            , dataType: 'json'
            , timeout: 100000
            , success: function (json) {
                if (json && "resCode" in json) {
                    _data = json;
                } else {
                    _data = {};
                }
            }, complete: function () {
                if (callback && callback instanceof Function) {
                    callback(_data);
                }
            }
        });
    };
    var warehouse = function (callback) {
        var _data = {};
        $.ajax({
            url: '/api/warehouse/list'
            , type: 'post'
            , dataType: 'json'
            , timeout: 100000
            , success: function (json) {
                if (json && "resCode" in json) {
                    _data = json;
                } else {
                    _data = {};
                }
            }, complete: function () {
                if (callback && callback instanceof Function) {
                    callback(_data);
                }
            }
        });
    };
    var add = function (data, callback) {
        var _data = {};
        $.ajax({
            url: '/api/airline/company/add'
            , type: 'post'
            , dataType: 'json'
            , data: data
            , timeout: 100000
            , success: function (json) {
                if (json && "resCode" in json) {
                    _data = json;
                } else {
                    _data = {};
                }
            }, complete: function () {
                if (callback && callback instanceof Function) {
                    callback(_data);
                }
            }
        });
    };
    var list = function (data, callback) {
        var _data = {};
        $.ajax({
            url: '/api/airline/company/list'
            , type: 'post'
            , dataType: 'json'
            , data: data
            , timeout: 100000
            , success: function (json) {
                if (json && "resCode" in json) {
                    _data = json;
                } else {
                    _data = {};
                }
            }, complete: function () {
                if (callback && callback instanceof Function) {
                    callback(_data);
                }
            }
        });
    };
    var del = function (data, callback) {
        var _data = {};
        $.ajax({
            url: '/api/airline/company/del'
            , type: 'post'
            , dataType: 'json'
            , data: data
            , timeout: 100000
            , success: function (json) {
                if (json && "resCode" in json) {
                    _data = json;
                } else {
                    _data = {};
                }
            }, complete: function () {
                if (callback && callback instanceof Function) {
                    callback(_data);
                }
            }
        });
    };
    var detail = function (data, callback) {
        var _data = {};
        $.ajax({
            url: '/api/airline/company/detail'
            , type: 'post'
            , dataType: 'json'
            , data: data
            , timeout: 100000
            , success: function (json) {
                if (json && "resCode" in json) {
                    _data = json;
                } else {
                    _data = {};
                }
            }, complete: function () {
                if (callback && callback instanceof Function) {
                    callback(_data);
                }
            }
        });
    };
    var update = function (data, callback) {
        var _data = {};
        $.ajax({
            url: '/api/airline/company/update'
            , type: 'post'
            , dataType: 'json'
            , data: data
            , timeout: 100000
            , success: function (json) {
                if (json && "resCode" in json) {
                    _data = json;
                } else {
                    _data = {};
                }
            }, complete: function () {
                if (callback && callback instanceof Function) {
                    callback(_data);
                }
            }
        });
    };
    var down = function (data, callback) {
        var _data = {};
        $.ajax({
            url: '/api/other/ossDown'
            , type: 'post'
            , dataType: 'json'
            , data: data
            , timeout: 100000
            , success: function (json) {
                if (json && "resCode" in json) {
                    _data = json;
                } else {
                    _data = {};
                }
            }, complete: function () {
                if (callback && callback instanceof Function) {
                    callback(_data);
                }
            }
        });
    };
    var up = function (data, callback) {
        var _data = {};
        $.ajax({
            url: '/api/other/ossUp'
            , type: 'post'
            , dataType: 'json'
            , data: data
            , timeout: 100000
            , success: function (json) {
                if (json && "resCode" in json) {
                    _data = json;
                } else {
                    _data = {};
                }
            }, complete: function () {
                if (callback && callback instanceof Function) {
                    callback(_data);
                }
            }
        });
    };
    var ossUpload = function (param, data, callback) {
        var _data = {};
        var formdata = new FormData();
        formdata.append("OSSAccessKeyId", param.AccessKeyId);
        formdata.append("policy", param.Policy);
        formdata.append("Signature", param.Signature);
        formdata.append("key", param.Keyname);
        formdata.append("Content-Disposition", "attachment;filename=\"" + data.name + "\"");
        formdata.append("file", data);
        $.ajax({
            url: param.UploadURL
            , data: formdata
            , processData: false
            , cache: false
            , async: false
            , contentType: false
            , type: 'post'
            , timeout: 100000
            , success: function () {
                _data = {
                    status: 1
                }
            }, error: function () {
                _data = {
                    status: -1
                }
            }, complete: function () {
                if (callback && callback instanceof Function) {
                    callback(_data);
                }
            }
        });
    };
    var addFile = function (data, callback) {
        var _data = {};
        $.ajax({
            url: '/api/airline/company/addFile'
            , type: 'post'
            , dataType: 'json'
            , data: data
            , timeout: 100000
            , success: function (json) {
                if (json && "resCode" in json) {
                    _data = json;
                } else {
                    _data = {};
                }
            }, complete: function () {
                if (callback && callback instanceof Function) {
                    callback(_data);
                }
            }
        });
    };
    var delFile = function (data, callback) {
        var _data = {};
        $.ajax({
            url: '/api/airline/company/delFile'
            , type: 'post'
            , dataType: 'json'
            , data: data
            , timeout: 100000
            , success: function (json) {
                if (json && "resCode" in json) {
                    _data = json;
                } else {
                    _data = {};
                }
            }, complete: function () {
                if (callback && callback instanceof Function) {
                    callback(_data);
                }
            }
        });
    };
    return {
        getName: getName
        , getCode: getCode
        , priceList: priceList
        , warehouse: warehouse
        , add: add
        , list: list
        , del: del
        , detail: detail
        , update: update
        , down: down
        , up: up
        , ossUpload: ossUpload
        , addFile: addFile
        , delFile: delFile
    }
}());
module.exports.Data = Data;
},{}],2:[function(require,module,exports){
/**
 * Created by Jeremy on 2017/2/6.
 */
'use strict';
var Dom = (function () {
    var list = function (json) {
        var str = '';
        if (json && json.resCode == 0 && 'resBody' in json && json.resBody && 'sList' in json.resBody && json.resBody.sList instanceof Array) {
            if (json.resBody.sList.length > 0) {
                var arr = json.resBody.sList;
                for (var a in arr) {
                    if (arr.hasOwnProperty(a)) {
                        str += render(arr[a]);
                    }
                }
            } else {
                str = '<tr class="wrong"><td colspan="8">暂无信息，请添加！</td></tr>';
            }
        } else {
            str = '<tr class="wrong"><td colspan="8">请求失败，<a href="">请重试！</a></td></tr>';
        }
        function render(d) {
            var str = '';
            for (var e in d.deptAirports) {
                if (d.deptAirports.hasOwnProperty(e)) {
                    var dt = d.deptAirports[e];
                    str += dt.airportCode + (e == d.deptAirports.length - 1 ? '' : ' , ');
                }
            }
            return '<tr> <td>' + d.airCompanyCode + '（' + d.airCompanyName + '）</td>  <td>' + d.airCompanyCountry + '</td> ' +
                '<td>' + (parseFloat(d.bulkyRate) * 10 + '/' + (10 - parseFloat(d.bulkyRate) * 10)) + '</td> <td>' + d.warehouseName + '</td> <td>' + str + '</td>' +
                '<td>' + d.destCount + '</td><td>' + d.airwayCount + '</td> <td>' +
                ' <a href="javascript:void(0);" class="update-btn" data-id="' + d.Id + '">修改</a> ' +
                '<a href="javascript:void(0);" class="del-btn" data-id="' + d.Id + '">删除</a> </td> </tr>';
        }

        $('.outer-tb').find('tbody').html(str);
    };
    return {
        list: list
    }
}());
module.exports.Dom = Dom;
},{}],3:[function(require,module,exports){
/**
 * Created by Jeremy on 2017/1/4.
 */
'use strict';
var Listener = require('./listener').Listener;
var general = require('../../general/general').general;
general.run();
Listener.run();

},{"../../general/general":6,"./listener":4}],4:[function(require,module,exports){
/**
 * Created by Jeremy on 2017/1/5.
 */
'use strict';
var Data = require('./data').Data
    , Dom = require('./dom').Dom
    , url = require('../../general/function').url
    , Modal = require('../../general/modal');
var Listener = (function () {
    var ports, company;
    //var save = {};
    var save = JSON.parse(oriSave.replace(/&#34;/g, '\"').replace(/\\/g, '').replace(/&#39;/g, "\'")) || {};

    var listener = function () {
        //最小输入200
        $(document).on('blur', '#min-price', function () {
            var val = parseInt($(this).val()) || 0;
            if (val < 200) {
                $(this).val(200);
                Modal.setAlert('最低价格不能低于200！');
            }
        });
        //删除
        $(document).on('click', '.remove-tr', function () {
            var key = $(this).data('key');
            $(this).parents('tr').remove();
            delete save[key];
        });
        //提交
        $(document).on('click', '#editor-ensure', function () {
            var data = {
                "companyId": 0,
                "airCompanyCode": $('#inner-name').data('code'),
                "airCompanyName": $('#inner-name').val(),
                "airCompanyCountry": $('#country').val(),
                "airwayBillCode": $('#o-header').val(),
                "officeAddress": $('#bscdz').val(),
                "AWC_Fee": parseInt($('#AWC-price').val()),
                "CGC_Fee": parseInt($('#CGC-price').val()),
                "minPrice": $('#min-price').val(),
                "bulkyRate": $('#percentage').find('option:selected').val(),
                "warehouseId": $('#warehouse').find('option:selected').val(),
                "templateId": $('#price').find('option:selected').val(),
                "deptAirports": [],
                "configState": 1
            };
            var deptAirports = [];
            var ele = $('.inner-tb').find('tbody').find('tr');
            ele.each(function () {
                deptAirports.push(save[$(this).data('key')]);
            });
            data['deptAirports'] = deptAirports;
            if ($(this).data('type') == 1) {
                Data.add(data, function (json) {
                    if (json && 'resCode' in json && json.resCode == 0) {
                        Modal.setAlert(json.resMsg || '添加成功！', null, function () {
                            location.reload();
                        });
                    } else {
                        Modal.setAlert(json.resMsg || '添加失败，请重试！');
                    }
                });
            } else {
                data['Id'] = $(this).data('id');
                Data.update(data, function (json) {
                    if (json && 'resCode' in json && json.resCode == 0) {
                        Modal.setAlert(json.resMsg || '修改成功！', null, function () {
                            location.reload();
                        });
                    } else {
                        Modal.setAlert(json.resMsg || '修改失败，请重试！');
                    }
                });
            }
        });
    };
    var airports = function () {
        //获取机场名称
        $(document).on('keyup', 'input#start', function (e) {
            var cd = $('#inner-name').data('code');
            if (cd != 0) {
                $('#code').removeClass('warm');
                var _this = $(this)
                    , ul = _this.siblings('.get-name');
                var index = ul.find('.active').index() || 0
                    , len = ul.children().length;
                var str = '';
                if (e.keyCode == 13) {//回车键
                    var data = ul.children('.active').data('val') || ul.find('li:first-child').data('val') || '';
                    $(this).val('');
                    $(this).data('val', data);
                    if (ports && data) {
                        if ($('.add-tr[data-key="' + data + '"]').length == 0) {
                            save[data] = ports[data];
                            str = '<tr class="add-tr" data-key="' + data + '"> <td>' + data + '</td> <td>' + ports[data].displayName + '</td> ' +
                                '<td class="big"> <div class="dp-tb"> ' +
                                ' <div class="add"> <div class="top"> + </div> <a href="javascript:void(0);" class="dp-b">添加文件</a> ' +
                                '<input type="file" class="up-file" data-p="' + data + '" data-c="' + $('#inner-name').data('code') + '"></div> </div> </td>' +
                                '<td><a href="javascript:void(0);" class="remove-tr" data-key="' + data + '">删除</a></td> </tr>';
                        }
                    }
                    $('.inner-tb').find('tbody').append(str);
                    ul.hide();
                } else if (e.keyCode == 38) {//上键
                    index = index == 0 ? len - 1 : index - 1;
                    ul.find('li').removeClass('active');
                    ul.find('li').eq(index).addClass('active');
                } else if (e.keyCode == 40) {//下键
                    index = index == len - 1 ? 0 : index + 1;
                    ul.find('li').removeClass('active');
                    ul.find('li').eq(index).addClass('active');
                } else {//正常输入
                    Data.getName({key: _this.val()}, function (json) {
                        if (json && 'resBody' in json && json.resBody instanceof Array && json.resBody.length > 0) {
                            var str = ''
                                , body = json.resBody;
                            var dt = {};
                            for (var b in body) {
                                if (body.hasOwnProperty(b)) {
                                    var d = body[b];
                                    str += '<li data-val="' + d.airportCode + '" class="' + (b == 0 ? 'active' : '') + '">' + d.displayName + '</li>';
                                    dt[d.airportCode] = d;
                                }
                            }
                            ports = dt;
                            ul.html(str);
                            ul.show();
                        }
                    });
                }
            } else {
                $('#code').addClass('warm');
            }
        });
        //input失去焦点
        $(document).on('blur', 'input#start', function () {
            var cd = $('#inner-name').data('code');
            if (cd != 0) {
                var ul = $(this).siblings('.get-name');
                var data = ul.children('.active').data('val') || ul.find('li:first-child').data('val') || '';
                $(this).val(data);
                $(this).data('val', data);
                ul.hide();
            }
        });
        //li元素悬浮获得焦点
        $(document).on('mouseenter ', '.get-name li', function () {
            $(this).addClass('active');
            $(this).siblings().removeClass('active');
        });
    };
    var companys = function () {
        //获取航空公司
        $(document).on('keyup', 'input#code', function (e) {
            var _this = $(this)
                , ul = _this.siblings('.get-name');
            var index = ul.find('.active').index() || 0
                , len = ul.children().length;
            if (e.keyCode == 13) {//回车键
                var data = ul.children('.active').data('val') || ul.find('li:first-child').data('val') || '';
                $(this).val(data);
                $('#inner-name').data('code', data);
                if (company && data) {
                    $('#inner-name').val(company[data].companyName || '');
                    $('#country').val(company[data].companyCountry || '');
                    $('#o-header').val(company[data].airwayBillCode || '');
                }
                ul.hide();
            } else if (e.keyCode == 38) {//上键
                index = index == 0 ? len - 1 : index - 1;
                ul.find('li').removeClass('active');
                ul.find('li').eq(index).addClass('active');
            } else if (e.keyCode == 40) {//下键
                index = index == len - 1 ? 0 : index + 1;
                ul.find('li').removeClass('active');
                ul.find('li').eq(index).addClass('active');
            } else {//正常输入
                Data.getCode({key: _this.val()}, function (json) {
                    if (json && 'resBody' in json && json.resBody instanceof Array && json.resBody.length > 0) {
                        var str = ''
                            , body = json.resBody;
                        var dt = {};
                        for (var b in body) {
                            if (body.hasOwnProperty(b)) {
                                var d = body[b];
                                str += '<li data-val="' + d.airlineCode + '" class="' + (b == 0 ? 'active' : '') + '">' + d.companyName + '</li>';
                                dt[d.airlineCode] = d;
                            }
                        }
                        company = dt;
                        ul.html(str);
                        ul.show();
                    } else {
                        ul.html('');
                    }
                });
            }
        });
        //input失去焦点
        $(document).on('blur', 'input#code', function () {
            var ul = $(this).siblings('.get-name');
            if (ul.children().length > 0) {
                var data = ul.children('.active').data('val') || ul.find('li:first-child').data('val') || '';
                $(this).val(data);
                $('#inner-name').data('code', data);
                $('#inner-name').val(company[data].companyName || '');
                $('#country').val(company[data].companyCountry || '');
                $('#o-header').val(company[data].airwayBillCode || '');
                ul.hide();
            }
        });
    };
    var priceInit = function () {
        Data.priceList(function (json) {
            var str = '';
            var id = $('#price').data('id');
            if (json && 'resCode' in json && json.resCode == 0 && 'sList' in json.resBody && json.resBody.sList) {
                var arr = json.resBody.sList;
                for (var a in arr) {
                    if (arr.hasOwnProperty(a)) {
                        var d = arr[a];
                        str += '<option value="' + d.templateId + '"' + (d.templateId == id ? ' selected' : '') + '>' + d.expenseName + '</option>';
                    }
                }
                $('#price').html(str);
            }
        });
    };
    var warehouseInit = function () {
        Data.warehouse(function (json) {
            var str = '';
            var id = $('#warehouse').data('id');
            if (json && 'resCode' in json && json.resCode == 0 && 'sList' in json.resBody && json.resBody.sList) {
                var arr = json.resBody.sList;
                for (var a in arr) {
                    if (arr.hasOwnProperty(a)) {
                        var d = arr[a];
                        str += '<option value="' + d.warehouseId + '"' + (d.warehouseId == id ? ' selected' : '') + '>' + d.warehouseName + '</option>';
                    }
                }
                $('#warehouse').html(str);
            }
        });
    };
    var files = function () {
        $(document).on('change', '.up-file', function () {
            var cd = $('#inner-name').data('code');
            if (cd != 0) {
                var arr = ['doc', 'docx', 'pdf', 'xlsx', 'xls'];
                var _this = $(this);
                var file = this.files[0]
                    , size = this.files[0].size
                    , name = this.files[0].name;
                var na = name.split('.');
                if (arr.indexOf(na[na.length - 1]) >= 0) {
                    if (size < 2097152) {
                        Data.up({"file": name}, function (json) {
                            var token;
                            if (json && 'resCode' in json && json.resCode == 0) {
                                token = json.resBody;
                            }
                            if (token) {
                                Data.ossUpload(token, file, function (data) {
                                    if (data && 'status' in data && data.status > 0) {
                                        var d = {
                                            "fileName": name,
                                            "fileComment": '',
                                            "keyName": token.Keyname,
                                            "agentCompanyId": 0,
                                            "airCompanyCode": $('#inner-name').data('code'),
                                            "airportCode": _this.data('p')
                                        };
                                        Data.addFile(d, function (json) {
                                            if (json && 'resCode' in json && json.resCode == 0 && json.resBody) {
                                                var d = json.resBody;
                                                var str = '<div class="files"> <div class="top">' + d.fileExtension.toUpperCase() + '<span class="glyphicon glyphicon-trash" data-key="' + d.keyName + '"></span> </div> <a href="javascript:void(0);" class="dp-b">' + d.fileName + '</a> </div>';
                                                _this.parents('.add').before(str);
                                                if (_this.parents('.add').siblings('.files').length == 3) {
                                                    _this.parents('.add').hide();
                                                }
                                            } else {
                                                Modal.setAlert(json.resMsg || '上传失败！');
                                            }
                                        });
                                    }
                                });
                            }
                        });
                    } else {
                        Modal.setAlert('您上传的文件超过2M！请重新选择。');
                    }
                } else {
                    Modal.setAlert('文件格式支持.doc/.docx/.xls/.xlsx/.pdf/');
                }
            } else {
                Modal.setAlert('请先选择航空公司！');
            }
        });
        $(document).on('click', '.glyphicon-trash', function () {
            var _this = $(this);
            var data = {
                "agentCompanyId": 0,
                "keyName": $(this).data('key')
            };
            Data.delFile(data, function (json) {
                if (json && 'resCode' in json && json.resCode == 0) {
                    if (_this.parents('.files').siblings('.files').length == 2) {
                        _this.parents('.files').siblings('.add').show();
                    }
                    _this.parents('.files').remove();
                } else {
                    Modal.setAlert('删除失败！');
                }
            });
        });
    };
    var run = function () {
        listener();
        priceInit();
        warehouseInit();
        files();
        companys();
        airports();
    };
    return {
        run: run
    }
}());
module.exports.Listener = Listener;
},{"../../general/function":5,"../../general/modal":7,"./data":1,"./dom":2}],5:[function(require,module,exports){
/**
 * Created by zrz on 2016/2/26.
 * @version 1.0.0 created 通用性功能方法
 */

'use strict';

var Fun = (function () {
    var _timeOut = 100000;//请求超时时间为10s
    /**
     * 封装ajax
     * @param option
     * {
     *      url:"请求的地址"
     *      ,method:"请求的方法"
     *      ,async:"是否并发"
     *      ,data:"发送的数据"
     *      ,success:"成功时回调"
     *      ,error:"失败/超时时回调"
     *      ,timeout:"超时时间"
     *      ,complete:"完成后的回调"
     * }
     */
    var ajax = function (option) {
        //ajax开始时应显示“加载信息框”
        Modal.showLoading();
        $.ajax({
            url: option.url
            , type: "type" in option && option.type || "GET"
            , timeout: option.timeout || _timeOut
            , data: "data" in option && option.data || {}
            , dataType: "json"
            , async: ("async" in option && option.async) ? true : false
            , success: function (json) {
                if ("status" in json && json.status > 0 && "data" in json) {
                    if ("success" in option) {
                        option.success(json.data);
                    } else {
                        Modal.setAlert("无success方法!");
                    }
                } else if ("error" in option && option.error instanceof Function) {
                    option.error(json);
                } else {
                    Modal.setAlert('操作失败!');
                }
            }, error: function (xhr) {//404或者超时
                if ("error" in option && option.error instanceof Function) {
                    //提示用户错误信息
                    Modal.showLoading(false);
                    Modal.setAlert("连接服务器失败，状态：" + (xhr.status || -1) + ",信息：" + (xhr.statusText || "-"));
                    option.error(xhr.status, xhr.statusText);//回调请求的状态和错误信息
                }
            }, complete: function (xhr, type) {
                //关闭“加载信息框”
                Modal.showLoading(false);
                if ("complete" in option && option.complete instanceof Function) {
                    option.complete(xhr, type);//回调请求的xhr信息和类型
                }
            }
        });
    };
    //全选和单选的绑定
    var setCheckboxListener = function (allCheck, radioChecks) {
        //筛选单选按钮组
        var radioValueEles = $(radioChecks);
        //点击全选时，同组按钮被同步
        $(document).delegate(allCheck, "click", function () {
            if (radioValueEles && radioValueEles.length > 0) {
                for (var _r = 0; _r < radioValueEles.length; _r++) {
                    radioValueEles[_r].checked = $(this).is(":checked");
                }
            }
        });
        //点击单选按钮时，
        $(document).delegate(radioChecks, "click", function () {
            $(allCheck)[0].checked = $(radioChecks + ":checked").length == $(radioChecks).length;
        });
    };
    var url = (function () {
        var get = function (name) {
            var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)", "i");
            var r = window.location.search.substr(1).match(reg);
            if (r != null) return decodeURI(r[2]);
            return null;
        };
        /**
         * 根据参数列表长度进行判断，兼容IE9
         * @returns {string}
         */
        var set = function () {
            if (arguments.length === 1 && typeof arguments[0] === 'object') {//一个对象，使用key标记value
                var obj = arguments[0]
                    , search = location.search;
                for (var o in obj) {
                    if (obj.hasOwnProperty(o)) {
                        search = changeURLKeyValue(search, o, obj[o]);
                    }
                }
                if ('pushState' in history) {
                    history.pushState(null, document.title, search);
                } else if ('pushState' in History) {//ie9 不支持pushState方法,javascript.ejs中添加history.js完成html4对pushState的支持
                    History.pushState(null, null, search);//返回重新构造后search串
                }
            } else if (arguments.length === 2) {//key+value
                var key = arguments[0]
                    , value = arguments[1];
                if ('pushState' in history) {
                    history.pushState(null, document.title, changeURLKeyValue(location.toString(), key, value));
                } else if ('pushState' in History) {//ie9 不支持pushState方法,javascript.ejs中添加history.js完成html4对pushState的支持
                    History.pushState(null, null, changeURLKeyValue(location.search, key, value));//返回重新构造后search串
                }
            }
            function changeURLKeyValue(url, arg, arg_val) {
                var pattern = arg + '=([^&]*)';
                var replaceText = arg + '=' + arg_val;
                if (url.match(pattern)) {
                    var tmp = '/(' + arg + '=)([^&]*)/gi';
                    tmp = url.replace(eval(tmp), replaceText);
                    return tmp;
                } else {
                    if (url.match('[\?]')) {
                        return url + '&' + replaceText;
                    } else {
                        return url + '?' + replaceText;
                    }
                }
            }
        };
        return {
            get: get
            , set: set
        }
    }());

    var formatImage=function (path, size, ele) {
        if(path instanceof  Array && path.length>0){
            path = path[0];
        }
        var IMAGE_SIZE = {
            original: {
                path: "",
                size: ""
            },
            xlarge: {
                path: "_xlarge",
                size: "660*660"
            },
            large: {
                path: "_large",
                size: "420*420"
            },
            middle: {
                path: "_middle",
                size: "300*300"
            },
            small: {
                path: "_small",
                size: "240*240"
            },
            little: {
                path: "_little",
                size: "120*120"
            },
            micro: {
                path: "_micro",
                size: "60*60"
            }
        };
        size = IMAGE_SIZE[size || "middle"] || IMAGE_SIZE.middle;
        var pathTemp = /\.\w+?$/.exec(path);
        if (!pathTemp) {
            path += size.path;
        } else {
            path = (path.substr(0, pathTemp.index || path.length)) + size.path + pathTemp[0];
        }
        if (ele && ele.attr) {
            ele.attr("src", path);
        }
        return path;
    };
    //金额格式化小数点2位
    var format = (function () {
        var formatamount = function(_value){
            return parseFloat(_value).toFixed(2);
        };
        //体积格式化小数点2位
        var formatvolume = function(_value){
            return parseFloat(_value).toFixed(3);
        };
        //重量格式化小数点2位
        var formatweight = function(_value){
            return parseFloat(_value).toFixed(3);
        };
        return {
            formatamount: formatamount
            , formatvolume: formatvolume
            , formatweight: formatweight
        }
    }());
    return {
        ajax: ajax
        , getTimtout: _timeOut
        , setCheckboxListener: setCheckboxListener
        , url: url
        , formatImage: formatImage
        , format: format
    }
}());

exports.ajax = Fun.ajax;
exports.getTimeout = Fun.getTimtout;
exports.setCheckboxListener = Fun.setCheckboxListener;
exports.url = Fun.url;
exports.formatImage = Fun.formatImage;
exports.format = Fun.format;

},{}],6:[function(require,module,exports){
/**
 * Created by Jeremy on 2017/1/23.
 */
'use strict';
var Modal = require('./modal');
var general = (function () {
    var run = function () {
        //时间格式化
        Date.prototype.Format = function (fmt) { //author: Jeremyyy
            var o = {
                "M+": this.getMonth() + 1, //月份
                "d+": this.getDate(), //日
                "h+": this.getHours(), //小时
                "m+": this.getMinutes(), //分
                "s+": this.getSeconds(), //秒
                "q+": Math.floor((this.getMonth() + 3) / 3), //季度
                "S": this.getMilliseconds() //毫秒
            };
            if (/(y+)/.test(fmt)) fmt = fmt.replace(RegExp.$1, (this.getFullYear() + "").substr(4 - RegExp.$1.length));
            for (var k in o)
                if (new RegExp("(" + k + ")").test(fmt)) fmt = fmt.replace(RegExp.$1, (RegExp.$1.length == 1) ? (o[k]) : (("00" + o[k]).substr(("" + o[k]).length)));
            return fmt;
        };

        //修改密码
        $(document).on('click', '#change-pwd', function () {
            $('.change-back').removeClass('dp-n');
            $('.change-pwd').removeClass('dp-n');
        });
        //关闭修改密码
        $(document).on('click', '.close-pwd', function () {
            $('.change-back').addClass('dp-n');
            $('.change-pwd').addClass('dp-n');
        });
        $(document).on('click', '#ensure-pwd', function () {
            if ($('#new-password').val() != $('#ensure-password').val()) {
                $('#ensure-password').addClass('warm');
            } else {
                $('#ensure-password').removeClass('warm');
                var data = {
                    "agentMemberId": 0,
                    "oldPwd": $('#password').val(),
                    "pwd": $('#new-password').val(),
                    "pwdConfirm": $('#ensure-password').val()
                };
                $.ajax({
                    url: '/api/account/changePwd'
                    , type: 'post'
                    , data: data
                    , dataType: 'json'
                    , timeout: 100000
                    , success: function (json) {
                        if (json && 'resCode' in json && json.resCode == 0) {
                            Modal.setAlert('修改成功！', null, function () {
                                $('.change-back').addClass('dp-n');
                                $('.change-pwd').addClass('dp-n');
                            });
                        } else {
                            Modal.setAlert(json.resMsg || '修改失败，请重试！');
                        }
                    }
                });
            }
        });
    };
    return {
        run: run
    }
}());
module.exports.general = general;
},{"./modal":7}],7:[function(require,module,exports){
/**
 * Created by zrz on 2016/2/24.
 * @version 1.0.0 created
 */

'use strict';

//构造信息框主体
var Modal = (function () {
    //构造原始类
    function M(m) {
        this.s = m.s;//是否显示
        this.id = m.id;
    }

    //构造标准show方法，用于继承
    M.prototype.show = function () {
        var ele = document.getElementById(this.id);
        if (ele) {
            if (this.s && !isShow()) {//显示当前隐藏
                ele.className = ele.className.replace("dp-n", "");
            } else if (!this.s && isShow()) {//隐藏当前显示
                ele.className += " dp-n";
            }
            //去除两边的空格
            ele.className = String(ele.className).trim();
        }
        function isShow() {//是否已显示，无class时显示
            return ele.className.split("dp-n").length == 1;
        }
    };

    //加载信息框
    var loading = (function () {
        //初始化生成加载信息框
        var init = function () {
            if (!document.getElementById("loading_modal_element")) {
                $('body').append('<div id="loading_modal_element" class="loading-modal-body dp-n"><div class="cover_modal_element"></div>' +
                    '<div class="loading-modal-image"></div>' +
                    '<div class="loading-modal-text">' +
                    '<h2>玩命加载中……</h2>' +
                    '</div></div>');
            }
            return false;
        };
        //显示、隐藏信息框
        var show = function (s) {
            s = typeof s == "undefined" ? true : s;//无参数显示信息框
            var m = new M({id: "loading_modal_element", s: s});
            m.show();
        };
        return {
            init: init
            , show: show
        }
    }());
    //弹出信息框
    var alert = (function () {
        var init = function () {
            if (!document.getElementById("alert_modal_element")) {
                $('body').append('<div id="alert_modal_element" class="alert-modal-element dp-n"><div class="cover_modal_element"></div>' +
                    '<div class="alert-modal-content">' +
                    '<div class="alert-modal-body"><span class="alert-modal-text"></span></div>' +
                    '<div class="alert-modal-footer"><button id="alert_modal_close" class="alert-modal-button">关闭</button></div>' +
                    '</div></div>');
            }
            return false;
        };
        var show = function (s) {
            s = typeof s == "undefined" ? true : s;
            var m = new M({id: "alert_modal_element", s: s});
            m.show();
        };
        /**
         * 设置弹出信息框
         * @param msg       显示的信息，支持html
         * @param sed       倒计时关闭时间，单位：second
         * @param callback  关闭触发回调函数
         */
        var set = function (msg, sed, callback) {
            var ele = document.getElementById("alert_modal_element");
            if (msg) {
                if (typeof msg === 'object') {//应对后端返回提示时使用Object封装
                    msg = JSON.stringify(msg);
                }
                if(ele){
                    ele.getElementsByClassName("alert-modal-text")[0].innerHTML = msg;
                }else{
                    init();
                    ele.getElementsByClassName("alert-modal-text")[0].innerHTML = msg;
                }
                show();
            }
            if (sed > 0) {
                setTimeout(function () {
                    show(false);
                }, 1000 * sed);
            }//无关闭时间或者关闭时间为0，不自动关闭
            //fixme 事件监听的ie兼容性
            //关闭按钮的事件侦听
            $("#alert_modal_close").on("click", function () {
                if (callback && callback instanceof Function) {
                    callback();
                }
                show(false);
                //阻止事件继续传递
                return false;
            });
        };
        return {
            init: init
            , show: show
            , set: set
        }
    }());
    //选择信息框
    var confirm = (function () {
        var init = function () {
            if (!document.getElementById("confirm_modal_element")) {
                $('body').append('<div id="confirm_modal_element" class="confirm-modal-element dp-n"><div class="cover_modal_element"></div>' +
                    '<div class="confirm-modal-content">' +
                    '<div id="confirm_modal_header" class="confirm-modal-header dp-n"></div>' +
                    '<div class="confirm-modal-body"><span id="confirm_modal_text" class="confirm-modal-text"></span></div>' +
                    '<div class="confirm-modal-footer">' +
                    '<div class="footer-button-success"><button class="confirm-modal-button  modal-success" data-confirm="success">确认</button></div>' +
                    '<div class="footer-button-false"><button class="confirm-modal-button" data-confirm="error">取消</button></div>' +
                    '</div></div></div>');
            }
            return false;
        };
        var show = function (s) {
            s = typeof s == "undefined" ? true : s;
            var m = new M({id: "confirm_modal_element", s: s});
            m.show();
        };
        /**
         * 设置选择信息框的内容
         * @param option    配置
         * {
         *      title:"头部显示的信息"
         *      ,text:"显示的提示信息"
         *      ,success:"点击成功后的回调"
         *      ,error:"点击失败后的回调"
         *      ,complete:"点击按钮后的整体回调"
         * }
         */
        var bar = 0;
        var set = function (option) {
            if (!option) {
                return false;
            }
            if ("title" in option && option.title.length > 0) {//有头部，则显示头部
                document.getElementById("confirm_modal_header").innerHTML = option.title;
            }
            if ("text" in option && option.text.length > 0) {//有内容，则显示整个选择信息框
                document.getElementById("confirm_modal_text").innerHTML = option.text;
            }
            //fixme 事件监听的ie兼容性
            //关闭按钮的事件侦听
            $("#confirm_modal_element").find(".confirm-modal-button").off("click").on("click", function () {
                //fixme .off("click")用于防止多次触发<--很玄学，我也不知道为什么，但是请不要修改。
                var atr = $(this).attr("data-confirm");//选择的按钮
                bar++;
                if (option && atr in option && option[atr] instanceof Function) {
                    option[atr]();
                }
                if (option && "complete" in option && option.complete instanceof Function) {
                    option.complete();//若有完成函数，则执行
                } else {//否则，关闭选择框
                    show(false);
                }
                //阻止事件继续传递
                //return false;
            });
        };
        return {
            init: init
            , show: show
            , set: set
        }
    }());
    //覆盖层
    var cover = (function () {
        var init = function () {
            if (!document.getElementById("cover_modal_element")) {
                $('body').append('<div id="cover_modal_element" class="cover-modal-element dp-n"></div>');
            }
            return false;
        };
        var hide = function () {
            document.getElementById("cover_modal_element").style.display = "none";
        };
        var show = function () {
            document.getElementById("cover_modal_element").style.display = "block";
        };
        return {
            init: init
            , show: show
            , hide: hide
        }
    }());
    return {
        initLoading: loading.init
        , showLoading: loading.show

        , initAlert: alert.init
        , showAlert: alert.show
        , setAlert: alert.set

        , initConfirm: confirm.init
        , setConfirm: confirm.set
        , showConfirm: confirm.show
        , initCover: cover.init
    }
}());

//页面加载完毕后生成四个自定义模态框
setTimeout(function () {
    //页面加载时生成一个覆盖层
    Modal.initCover();
    //页面加载时生成一个加载信息框
    Modal.initLoading();
    //页面加载时生成一个弹出信息框
    Modal.initAlert();
    //页面加载时生成一个选择信息框
    Modal.initConfirm();
}, 100);


//抛出上层调用
exports.showLoading = Modal.showLoading;
exports.setAlert = Modal.setAlert;
exports.showAlert = Modal.showAlert;
exports.setConfirm = Modal.setConfirm;
exports.showConfirm = Modal.showConfirm;
},{}]},{},[3])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uLy4uLy4uLy4uL252bS92Ni4yLjAvbm9kZV9tb2R1bGVzL2Jyb3dzZXJpZnkvbm9kZV9tb2R1bGVzL2Jyb3dzZXItcGFjay9fcHJlbHVkZS5qcyIsImRhdGEuanMiLCJkb20uanMiLCJpbmRleC5qcyIsImxpc3RlbmVyLmpzIiwiLi4vLi4vZ2VuZXJhbC9mdW5jdGlvbi5qcyIsIi4uLy4uL2dlbmVyYWwvZ2VuZXJhbC5qcyIsIi4uLy4uL2dlbmVyYWwvbW9kYWwuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUNBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDdFVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDUkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUN4VUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3ZOQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNyRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJmaWxlIjoiZ2VuZXJhdGVkLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiBlKHQsbixyKXtmdW5jdGlvbiBzKG8sdSl7aWYoIW5bb10pe2lmKCF0W29dKXt2YXIgYT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2lmKCF1JiZhKXJldHVybiBhKG8sITApO2lmKGkpcmV0dXJuIGkobywhMCk7dmFyIGY9bmV3IEVycm9yKFwiQ2Fubm90IGZpbmQgbW9kdWxlICdcIitvK1wiJ1wiKTt0aHJvdyBmLmNvZGU9XCJNT0RVTEVfTk9UX0ZPVU5EXCIsZn12YXIgbD1uW29dPXtleHBvcnRzOnt9fTt0W29dWzBdLmNhbGwobC5leHBvcnRzLGZ1bmN0aW9uKGUpe3ZhciBuPXRbb11bMV1bZV07cmV0dXJuIHMobj9uOmUpfSxsLGwuZXhwb3J0cyxlLHQsbixyKX1yZXR1cm4gbltvXS5leHBvcnRzfXZhciBpPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7Zm9yKHZhciBvPTA7bzxyLmxlbmd0aDtvKyspcyhyW29dKTtyZXR1cm4gc30pIiwiLyoqXHJcbiAqIENyZWF0ZWQgYnkgQXVzZXIgb24gMjAxNi8xMi82LlxyXG4gKi9cclxuXCJ1c2Ugc3RyaWN0XCI7XHJcbnZhciBEYXRhID0gKGZ1bmN0aW9uICgpIHtcclxuICAgIHZhciBnZXROYW1lID0gZnVuY3Rpb24gKGRhdGEsIGNhbGxiYWNrKSB7XHJcbiAgICAgICAgdmFyIF9kYXRhID0ge307XHJcbiAgICAgICAgJC5hamF4KHtcclxuICAgICAgICAgICAgdXJsOiAnL2FwaS9haXJsaW5lL21hbmFnZS9nZXROYW1lJ1xyXG4gICAgICAgICAgICAsIHR5cGU6ICdwb3N0J1xyXG4gICAgICAgICAgICAsIGRhdGE6IGRhdGFcclxuICAgICAgICAgICAgLCBkYXRhVHlwZTogJ2pzb24nXHJcbiAgICAgICAgICAgICwgdGltZW91dDogMTAwMDAwXHJcbiAgICAgICAgICAgICwgc3VjY2VzczogZnVuY3Rpb24gKGpzb24pIHtcclxuICAgICAgICAgICAgICAgIGlmIChqc29uICYmIFwicmVzQ29kZVwiIGluIGpzb24pIHtcclxuICAgICAgICAgICAgICAgICAgICBfZGF0YSA9IGpzb247XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIF9kYXRhID0ge307XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0sIGNvbXBsZXRlOiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoY2FsbGJhY2sgJiYgY2FsbGJhY2sgaW5zdGFuY2VvZiBGdW5jdGlvbikge1xyXG4gICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKF9kYXRhKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfTtcclxuICAgIHZhciBnZXRDb2RlID0gZnVuY3Rpb24gKGRhdGEsIGNhbGxiYWNrKSB7XHJcbiAgICAgICAgdmFyIF9kYXRhID0ge307XHJcbiAgICAgICAgJC5hamF4KHtcclxuICAgICAgICAgICAgdXJsOiAnL2FwaS9haXJsaW5lL21hbmFnZS9nZXRDb2RlJ1xyXG4gICAgICAgICAgICAsIHR5cGU6ICdwb3N0J1xyXG4gICAgICAgICAgICAsIGRhdGE6IGRhdGFcclxuICAgICAgICAgICAgLCBkYXRhVHlwZTogJ2pzb24nXHJcbiAgICAgICAgICAgICwgdGltZW91dDogMTAwMDAwXHJcbiAgICAgICAgICAgICwgc3VjY2VzczogZnVuY3Rpb24gKGpzb24pIHtcclxuICAgICAgICAgICAgICAgIGlmIChqc29uICYmIFwicmVzQ29kZVwiIGluIGpzb24pIHtcclxuICAgICAgICAgICAgICAgICAgICBfZGF0YSA9IGpzb247XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIF9kYXRhID0ge307XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0sIGNvbXBsZXRlOiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoY2FsbGJhY2sgJiYgY2FsbGJhY2sgaW5zdGFuY2VvZiBGdW5jdGlvbikge1xyXG4gICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKF9kYXRhKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfTtcclxuICAgIHZhciBwcmljZUxpc3QgPSBmdW5jdGlvbiAoY2FsbGJhY2spIHtcclxuICAgICAgICB2YXIgX2RhdGEgPSB7fTtcclxuICAgICAgICAkLmFqYXgoe1xyXG4gICAgICAgICAgICB1cmw6ICcvYXBpL2FpcmxpbmUvcHJpY2UvbGlzdCdcclxuICAgICAgICAgICAgLCB0eXBlOiAncG9zdCdcclxuICAgICAgICAgICAgLCBkYXRhVHlwZTogJ2pzb24nXHJcbiAgICAgICAgICAgICwgdGltZW91dDogMTAwMDAwXHJcbiAgICAgICAgICAgICwgc3VjY2VzczogZnVuY3Rpb24gKGpzb24pIHtcclxuICAgICAgICAgICAgICAgIGlmIChqc29uICYmIFwicmVzQ29kZVwiIGluIGpzb24pIHtcclxuICAgICAgICAgICAgICAgICAgICBfZGF0YSA9IGpzb247XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIF9kYXRhID0ge307XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0sIGNvbXBsZXRlOiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoY2FsbGJhY2sgJiYgY2FsbGJhY2sgaW5zdGFuY2VvZiBGdW5jdGlvbikge1xyXG4gICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKF9kYXRhKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfTtcclxuICAgIHZhciB3YXJlaG91c2UgPSBmdW5jdGlvbiAoY2FsbGJhY2spIHtcclxuICAgICAgICB2YXIgX2RhdGEgPSB7fTtcclxuICAgICAgICAkLmFqYXgoe1xyXG4gICAgICAgICAgICB1cmw6ICcvYXBpL3dhcmVob3VzZS9saXN0J1xyXG4gICAgICAgICAgICAsIHR5cGU6ICdwb3N0J1xyXG4gICAgICAgICAgICAsIGRhdGFUeXBlOiAnanNvbidcclxuICAgICAgICAgICAgLCB0aW1lb3V0OiAxMDAwMDBcclxuICAgICAgICAgICAgLCBzdWNjZXNzOiBmdW5jdGlvbiAoanNvbikge1xyXG4gICAgICAgICAgICAgICAgaWYgKGpzb24gJiYgXCJyZXNDb2RlXCIgaW4ganNvbikge1xyXG4gICAgICAgICAgICAgICAgICAgIF9kYXRhID0ganNvbjtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgX2RhdGEgPSB7fTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSwgY29tcGxldGU6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIGlmIChjYWxsYmFjayAmJiBjYWxsYmFjayBpbnN0YW5jZW9mIEZ1bmN0aW9uKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soX2RhdGEpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9O1xyXG4gICAgdmFyIGFkZCA9IGZ1bmN0aW9uIChkYXRhLCBjYWxsYmFjaykge1xyXG4gICAgICAgIHZhciBfZGF0YSA9IHt9O1xyXG4gICAgICAgICQuYWpheCh7XHJcbiAgICAgICAgICAgIHVybDogJy9hcGkvYWlybGluZS9jb21wYW55L2FkZCdcclxuICAgICAgICAgICAgLCB0eXBlOiAncG9zdCdcclxuICAgICAgICAgICAgLCBkYXRhVHlwZTogJ2pzb24nXHJcbiAgICAgICAgICAgICwgZGF0YTogZGF0YVxyXG4gICAgICAgICAgICAsIHRpbWVvdXQ6IDEwMDAwMFxyXG4gICAgICAgICAgICAsIHN1Y2Nlc3M6IGZ1bmN0aW9uIChqc29uKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoanNvbiAmJiBcInJlc0NvZGVcIiBpbiBqc29uKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgX2RhdGEgPSBqc29uO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBfZGF0YSA9IHt9O1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9LCBjb21wbGV0ZTogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKGNhbGxiYWNrICYmIGNhbGxiYWNrIGluc3RhbmNlb2YgRnVuY3Rpb24pIHtcclxuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayhfZGF0YSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH07XHJcbiAgICB2YXIgbGlzdCA9IGZ1bmN0aW9uIChkYXRhLCBjYWxsYmFjaykge1xyXG4gICAgICAgIHZhciBfZGF0YSA9IHt9O1xyXG4gICAgICAgICQuYWpheCh7XHJcbiAgICAgICAgICAgIHVybDogJy9hcGkvYWlybGluZS9jb21wYW55L2xpc3QnXHJcbiAgICAgICAgICAgICwgdHlwZTogJ3Bvc3QnXHJcbiAgICAgICAgICAgICwgZGF0YVR5cGU6ICdqc29uJ1xyXG4gICAgICAgICAgICAsIGRhdGE6IGRhdGFcclxuICAgICAgICAgICAgLCB0aW1lb3V0OiAxMDAwMDBcclxuICAgICAgICAgICAgLCBzdWNjZXNzOiBmdW5jdGlvbiAoanNvbikge1xyXG4gICAgICAgICAgICAgICAgaWYgKGpzb24gJiYgXCJyZXNDb2RlXCIgaW4ganNvbikge1xyXG4gICAgICAgICAgICAgICAgICAgIF9kYXRhID0ganNvbjtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgX2RhdGEgPSB7fTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSwgY29tcGxldGU6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIGlmIChjYWxsYmFjayAmJiBjYWxsYmFjayBpbnN0YW5jZW9mIEZ1bmN0aW9uKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soX2RhdGEpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9O1xyXG4gICAgdmFyIGRlbCA9IGZ1bmN0aW9uIChkYXRhLCBjYWxsYmFjaykge1xyXG4gICAgICAgIHZhciBfZGF0YSA9IHt9O1xyXG4gICAgICAgICQuYWpheCh7XHJcbiAgICAgICAgICAgIHVybDogJy9hcGkvYWlybGluZS9jb21wYW55L2RlbCdcclxuICAgICAgICAgICAgLCB0eXBlOiAncG9zdCdcclxuICAgICAgICAgICAgLCBkYXRhVHlwZTogJ2pzb24nXHJcbiAgICAgICAgICAgICwgZGF0YTogZGF0YVxyXG4gICAgICAgICAgICAsIHRpbWVvdXQ6IDEwMDAwMFxyXG4gICAgICAgICAgICAsIHN1Y2Nlc3M6IGZ1bmN0aW9uIChqc29uKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoanNvbiAmJiBcInJlc0NvZGVcIiBpbiBqc29uKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgX2RhdGEgPSBqc29uO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBfZGF0YSA9IHt9O1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9LCBjb21wbGV0ZTogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKGNhbGxiYWNrICYmIGNhbGxiYWNrIGluc3RhbmNlb2YgRnVuY3Rpb24pIHtcclxuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayhfZGF0YSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH07XHJcbiAgICB2YXIgZGV0YWlsID0gZnVuY3Rpb24gKGRhdGEsIGNhbGxiYWNrKSB7XHJcbiAgICAgICAgdmFyIF9kYXRhID0ge307XHJcbiAgICAgICAgJC5hamF4KHtcclxuICAgICAgICAgICAgdXJsOiAnL2FwaS9haXJsaW5lL2NvbXBhbnkvZGV0YWlsJ1xyXG4gICAgICAgICAgICAsIHR5cGU6ICdwb3N0J1xyXG4gICAgICAgICAgICAsIGRhdGFUeXBlOiAnanNvbidcclxuICAgICAgICAgICAgLCBkYXRhOiBkYXRhXHJcbiAgICAgICAgICAgICwgdGltZW91dDogMTAwMDAwXHJcbiAgICAgICAgICAgICwgc3VjY2VzczogZnVuY3Rpb24gKGpzb24pIHtcclxuICAgICAgICAgICAgICAgIGlmIChqc29uICYmIFwicmVzQ29kZVwiIGluIGpzb24pIHtcclxuICAgICAgICAgICAgICAgICAgICBfZGF0YSA9IGpzb247XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIF9kYXRhID0ge307XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0sIGNvbXBsZXRlOiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoY2FsbGJhY2sgJiYgY2FsbGJhY2sgaW5zdGFuY2VvZiBGdW5jdGlvbikge1xyXG4gICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKF9kYXRhKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfTtcclxuICAgIHZhciB1cGRhdGUgPSBmdW5jdGlvbiAoZGF0YSwgY2FsbGJhY2spIHtcclxuICAgICAgICB2YXIgX2RhdGEgPSB7fTtcclxuICAgICAgICAkLmFqYXgoe1xyXG4gICAgICAgICAgICB1cmw6ICcvYXBpL2FpcmxpbmUvY29tcGFueS91cGRhdGUnXHJcbiAgICAgICAgICAgICwgdHlwZTogJ3Bvc3QnXHJcbiAgICAgICAgICAgICwgZGF0YVR5cGU6ICdqc29uJ1xyXG4gICAgICAgICAgICAsIGRhdGE6IGRhdGFcclxuICAgICAgICAgICAgLCB0aW1lb3V0OiAxMDAwMDBcclxuICAgICAgICAgICAgLCBzdWNjZXNzOiBmdW5jdGlvbiAoanNvbikge1xyXG4gICAgICAgICAgICAgICAgaWYgKGpzb24gJiYgXCJyZXNDb2RlXCIgaW4ganNvbikge1xyXG4gICAgICAgICAgICAgICAgICAgIF9kYXRhID0ganNvbjtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgX2RhdGEgPSB7fTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSwgY29tcGxldGU6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIGlmIChjYWxsYmFjayAmJiBjYWxsYmFjayBpbnN0YW5jZW9mIEZ1bmN0aW9uKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soX2RhdGEpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9O1xyXG4gICAgdmFyIGRvd24gPSBmdW5jdGlvbiAoZGF0YSwgY2FsbGJhY2spIHtcclxuICAgICAgICB2YXIgX2RhdGEgPSB7fTtcclxuICAgICAgICAkLmFqYXgoe1xyXG4gICAgICAgICAgICB1cmw6ICcvYXBpL290aGVyL29zc0Rvd24nXHJcbiAgICAgICAgICAgICwgdHlwZTogJ3Bvc3QnXHJcbiAgICAgICAgICAgICwgZGF0YVR5cGU6ICdqc29uJ1xyXG4gICAgICAgICAgICAsIGRhdGE6IGRhdGFcclxuICAgICAgICAgICAgLCB0aW1lb3V0OiAxMDAwMDBcclxuICAgICAgICAgICAgLCBzdWNjZXNzOiBmdW5jdGlvbiAoanNvbikge1xyXG4gICAgICAgICAgICAgICAgaWYgKGpzb24gJiYgXCJyZXNDb2RlXCIgaW4ganNvbikge1xyXG4gICAgICAgICAgICAgICAgICAgIF9kYXRhID0ganNvbjtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgX2RhdGEgPSB7fTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSwgY29tcGxldGU6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIGlmIChjYWxsYmFjayAmJiBjYWxsYmFjayBpbnN0YW5jZW9mIEZ1bmN0aW9uKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soX2RhdGEpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9O1xyXG4gICAgdmFyIHVwID0gZnVuY3Rpb24gKGRhdGEsIGNhbGxiYWNrKSB7XHJcbiAgICAgICAgdmFyIF9kYXRhID0ge307XHJcbiAgICAgICAgJC5hamF4KHtcclxuICAgICAgICAgICAgdXJsOiAnL2FwaS9vdGhlci9vc3NVcCdcclxuICAgICAgICAgICAgLCB0eXBlOiAncG9zdCdcclxuICAgICAgICAgICAgLCBkYXRhVHlwZTogJ2pzb24nXHJcbiAgICAgICAgICAgICwgZGF0YTogZGF0YVxyXG4gICAgICAgICAgICAsIHRpbWVvdXQ6IDEwMDAwMFxyXG4gICAgICAgICAgICAsIHN1Y2Nlc3M6IGZ1bmN0aW9uIChqc29uKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoanNvbiAmJiBcInJlc0NvZGVcIiBpbiBqc29uKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgX2RhdGEgPSBqc29uO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBfZGF0YSA9IHt9O1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9LCBjb21wbGV0ZTogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKGNhbGxiYWNrICYmIGNhbGxiYWNrIGluc3RhbmNlb2YgRnVuY3Rpb24pIHtcclxuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayhfZGF0YSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH07XHJcbiAgICB2YXIgb3NzVXBsb2FkID0gZnVuY3Rpb24gKHBhcmFtLCBkYXRhLCBjYWxsYmFjaykge1xyXG4gICAgICAgIHZhciBfZGF0YSA9IHt9O1xyXG4gICAgICAgIHZhciBmb3JtZGF0YSA9IG5ldyBGb3JtRGF0YSgpO1xyXG4gICAgICAgIGZvcm1kYXRhLmFwcGVuZChcIk9TU0FjY2Vzc0tleUlkXCIsIHBhcmFtLkFjY2Vzc0tleUlkKTtcclxuICAgICAgICBmb3JtZGF0YS5hcHBlbmQoXCJwb2xpY3lcIiwgcGFyYW0uUG9saWN5KTtcclxuICAgICAgICBmb3JtZGF0YS5hcHBlbmQoXCJTaWduYXR1cmVcIiwgcGFyYW0uU2lnbmF0dXJlKTtcclxuICAgICAgICBmb3JtZGF0YS5hcHBlbmQoXCJrZXlcIiwgcGFyYW0uS2V5bmFtZSk7XHJcbiAgICAgICAgZm9ybWRhdGEuYXBwZW5kKFwiQ29udGVudC1EaXNwb3NpdGlvblwiLCBcImF0dGFjaG1lbnQ7ZmlsZW5hbWU9XFxcIlwiICsgZGF0YS5uYW1lICsgXCJcXFwiXCIpO1xyXG4gICAgICAgIGZvcm1kYXRhLmFwcGVuZChcImZpbGVcIiwgZGF0YSk7XHJcbiAgICAgICAgJC5hamF4KHtcclxuICAgICAgICAgICAgdXJsOiBwYXJhbS5VcGxvYWRVUkxcclxuICAgICAgICAgICAgLCBkYXRhOiBmb3JtZGF0YVxyXG4gICAgICAgICAgICAsIHByb2Nlc3NEYXRhOiBmYWxzZVxyXG4gICAgICAgICAgICAsIGNhY2hlOiBmYWxzZVxyXG4gICAgICAgICAgICAsIGFzeW5jOiBmYWxzZVxyXG4gICAgICAgICAgICAsIGNvbnRlbnRUeXBlOiBmYWxzZVxyXG4gICAgICAgICAgICAsIHR5cGU6ICdwb3N0J1xyXG4gICAgICAgICAgICAsIHRpbWVvdXQ6IDEwMDAwMFxyXG4gICAgICAgICAgICAsIHN1Y2Nlc3M6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIF9kYXRhID0ge1xyXG4gICAgICAgICAgICAgICAgICAgIHN0YXR1czogMVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9LCBlcnJvcjogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgX2RhdGEgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc3RhdHVzOiAtMVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9LCBjb21wbGV0ZTogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKGNhbGxiYWNrICYmIGNhbGxiYWNrIGluc3RhbmNlb2YgRnVuY3Rpb24pIHtcclxuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayhfZGF0YSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH07XHJcbiAgICB2YXIgYWRkRmlsZSA9IGZ1bmN0aW9uIChkYXRhLCBjYWxsYmFjaykge1xyXG4gICAgICAgIHZhciBfZGF0YSA9IHt9O1xyXG4gICAgICAgICQuYWpheCh7XHJcbiAgICAgICAgICAgIHVybDogJy9hcGkvYWlybGluZS9jb21wYW55L2FkZEZpbGUnXHJcbiAgICAgICAgICAgICwgdHlwZTogJ3Bvc3QnXHJcbiAgICAgICAgICAgICwgZGF0YVR5cGU6ICdqc29uJ1xyXG4gICAgICAgICAgICAsIGRhdGE6IGRhdGFcclxuICAgICAgICAgICAgLCB0aW1lb3V0OiAxMDAwMDBcclxuICAgICAgICAgICAgLCBzdWNjZXNzOiBmdW5jdGlvbiAoanNvbikge1xyXG4gICAgICAgICAgICAgICAgaWYgKGpzb24gJiYgXCJyZXNDb2RlXCIgaW4ganNvbikge1xyXG4gICAgICAgICAgICAgICAgICAgIF9kYXRhID0ganNvbjtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgX2RhdGEgPSB7fTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSwgY29tcGxldGU6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIGlmIChjYWxsYmFjayAmJiBjYWxsYmFjayBpbnN0YW5jZW9mIEZ1bmN0aW9uKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soX2RhdGEpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9O1xyXG4gICAgdmFyIGRlbEZpbGUgPSBmdW5jdGlvbiAoZGF0YSwgY2FsbGJhY2spIHtcclxuICAgICAgICB2YXIgX2RhdGEgPSB7fTtcclxuICAgICAgICAkLmFqYXgoe1xyXG4gICAgICAgICAgICB1cmw6ICcvYXBpL2FpcmxpbmUvY29tcGFueS9kZWxGaWxlJ1xyXG4gICAgICAgICAgICAsIHR5cGU6ICdwb3N0J1xyXG4gICAgICAgICAgICAsIGRhdGFUeXBlOiAnanNvbidcclxuICAgICAgICAgICAgLCBkYXRhOiBkYXRhXHJcbiAgICAgICAgICAgICwgdGltZW91dDogMTAwMDAwXHJcbiAgICAgICAgICAgICwgc3VjY2VzczogZnVuY3Rpb24gKGpzb24pIHtcclxuICAgICAgICAgICAgICAgIGlmIChqc29uICYmIFwicmVzQ29kZVwiIGluIGpzb24pIHtcclxuICAgICAgICAgICAgICAgICAgICBfZGF0YSA9IGpzb247XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIF9kYXRhID0ge307XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0sIGNvbXBsZXRlOiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoY2FsbGJhY2sgJiYgY2FsbGJhY2sgaW5zdGFuY2VvZiBGdW5jdGlvbikge1xyXG4gICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKF9kYXRhKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfTtcclxuICAgIHJldHVybiB7XHJcbiAgICAgICAgZ2V0TmFtZTogZ2V0TmFtZVxyXG4gICAgICAgICwgZ2V0Q29kZTogZ2V0Q29kZVxyXG4gICAgICAgICwgcHJpY2VMaXN0OiBwcmljZUxpc3RcclxuICAgICAgICAsIHdhcmVob3VzZTogd2FyZWhvdXNlXHJcbiAgICAgICAgLCBhZGQ6IGFkZFxyXG4gICAgICAgICwgbGlzdDogbGlzdFxyXG4gICAgICAgICwgZGVsOiBkZWxcclxuICAgICAgICAsIGRldGFpbDogZGV0YWlsXHJcbiAgICAgICAgLCB1cGRhdGU6IHVwZGF0ZVxyXG4gICAgICAgICwgZG93bjogZG93blxyXG4gICAgICAgICwgdXA6IHVwXHJcbiAgICAgICAgLCBvc3NVcGxvYWQ6IG9zc1VwbG9hZFxyXG4gICAgICAgICwgYWRkRmlsZTogYWRkRmlsZVxyXG4gICAgICAgICwgZGVsRmlsZTogZGVsRmlsZVxyXG4gICAgfVxyXG59KCkpO1xyXG5tb2R1bGUuZXhwb3J0cy5EYXRhID0gRGF0YTsiLCIvKipcclxuICogQ3JlYXRlZCBieSBKZXJlbXkgb24gMjAxNy8yLzYuXHJcbiAqL1xyXG4ndXNlIHN0cmljdCc7XHJcbnZhciBEb20gPSAoZnVuY3Rpb24gKCkge1xyXG4gICAgdmFyIGxpc3QgPSBmdW5jdGlvbiAoanNvbikge1xyXG4gICAgICAgIHZhciBzdHIgPSAnJztcclxuICAgICAgICBpZiAoanNvbiAmJiBqc29uLnJlc0NvZGUgPT0gMCAmJiAncmVzQm9keScgaW4ganNvbiAmJiBqc29uLnJlc0JvZHkgJiYgJ3NMaXN0JyBpbiBqc29uLnJlc0JvZHkgJiYganNvbi5yZXNCb2R5LnNMaXN0IGluc3RhbmNlb2YgQXJyYXkpIHtcclxuICAgICAgICAgICAgaWYgKGpzb24ucmVzQm9keS5zTGlzdC5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgYXJyID0ganNvbi5yZXNCb2R5LnNMaXN0O1xyXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgYSBpbiBhcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoYXJyLmhhc093blByb3BlcnR5KGEpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0ciArPSByZW5kZXIoYXJyW2FdKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBzdHIgPSAnPHRyIGNsYXNzPVwid3JvbmdcIj48dGQgY29sc3Bhbj1cIjhcIj7mmoLml6Dkv6Hmga/vvIzor7fmt7vliqDvvIE8L3RkPjwvdHI+JztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHN0ciA9ICc8dHIgY2xhc3M9XCJ3cm9uZ1wiPjx0ZCBjb2xzcGFuPVwiOFwiPuivt+axguWksei0pe+8jDxhIGhyZWY9XCJcIj7or7fph43or5XvvIE8L2E+PC90ZD48L3RyPic7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGZ1bmN0aW9uIHJlbmRlcihkKSB7XHJcbiAgICAgICAgICAgIHZhciBzdHIgPSAnJztcclxuICAgICAgICAgICAgZm9yICh2YXIgZSBpbiBkLmRlcHRBaXJwb3J0cykge1xyXG4gICAgICAgICAgICAgICAgaWYgKGQuZGVwdEFpcnBvcnRzLmhhc093blByb3BlcnR5KGUpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGR0ID0gZC5kZXB0QWlycG9ydHNbZV07XHJcbiAgICAgICAgICAgICAgICAgICAgc3RyICs9IGR0LmFpcnBvcnRDb2RlICsgKGUgPT0gZC5kZXB0QWlycG9ydHMubGVuZ3RoIC0gMSA/ICcnIDogJyAsICcpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiAnPHRyPiA8dGQ+JyArIGQuYWlyQ29tcGFueUNvZGUgKyAn77yIJyArIGQuYWlyQ29tcGFueU5hbWUgKyAn77yJPC90ZD4gIDx0ZD4nICsgZC5haXJDb21wYW55Q291bnRyeSArICc8L3RkPiAnICtcclxuICAgICAgICAgICAgICAgICc8dGQ+JyArIChwYXJzZUZsb2F0KGQuYnVsa3lSYXRlKSAqIDEwICsgJy8nICsgKDEwIC0gcGFyc2VGbG9hdChkLmJ1bGt5UmF0ZSkgKiAxMCkpICsgJzwvdGQ+IDx0ZD4nICsgZC53YXJlaG91c2VOYW1lICsgJzwvdGQ+IDx0ZD4nICsgc3RyICsgJzwvdGQ+JyArXHJcbiAgICAgICAgICAgICAgICAnPHRkPicgKyBkLmRlc3RDb3VudCArICc8L3RkPjx0ZD4nICsgZC5haXJ3YXlDb3VudCArICc8L3RkPiA8dGQ+JyArXHJcbiAgICAgICAgICAgICAgICAnIDxhIGhyZWY9XCJqYXZhc2NyaXB0OnZvaWQoMCk7XCIgY2xhc3M9XCJ1cGRhdGUtYnRuXCIgZGF0YS1pZD1cIicgKyBkLklkICsgJ1wiPuS/ruaUuTwvYT4gJyArXHJcbiAgICAgICAgICAgICAgICAnPGEgaHJlZj1cImphdmFzY3JpcHQ6dm9pZCgwKTtcIiBjbGFzcz1cImRlbC1idG5cIiBkYXRhLWlkPVwiJyArIGQuSWQgKyAnXCI+5Yig6ZmkPC9hPiA8L3RkPiA8L3RyPic7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAkKCcub3V0ZXItdGInKS5maW5kKCd0Ym9keScpLmh0bWwoc3RyKTtcclxuICAgIH07XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICAgIGxpc3Q6IGxpc3RcclxuICAgIH1cclxufSgpKTtcclxubW9kdWxlLmV4cG9ydHMuRG9tID0gRG9tOyIsIi8qKlxyXG4gKiBDcmVhdGVkIGJ5IEplcmVteSBvbiAyMDE3LzEvNC5cclxuICovXHJcbid1c2Ugc3RyaWN0JztcclxudmFyIExpc3RlbmVyID0gcmVxdWlyZSgnLi9saXN0ZW5lcicpLkxpc3RlbmVyO1xyXG52YXIgZ2VuZXJhbCA9IHJlcXVpcmUoJy4uLy4uL2dlbmVyYWwvZ2VuZXJhbCcpLmdlbmVyYWw7XHJcbmdlbmVyYWwucnVuKCk7XHJcbkxpc3RlbmVyLnJ1bigpO1xyXG4iLCIvKipcclxuICogQ3JlYXRlZCBieSBKZXJlbXkgb24gMjAxNy8xLzUuXHJcbiAqL1xyXG4ndXNlIHN0cmljdCc7XHJcbnZhciBEYXRhID0gcmVxdWlyZSgnLi9kYXRhJykuRGF0YVxyXG4gICAgLCBEb20gPSByZXF1aXJlKCcuL2RvbScpLkRvbVxyXG4gICAgLCB1cmwgPSByZXF1aXJlKCcuLi8uLi9nZW5lcmFsL2Z1bmN0aW9uJykudXJsXHJcbiAgICAsIE1vZGFsID0gcmVxdWlyZSgnLi4vLi4vZ2VuZXJhbC9tb2RhbCcpO1xyXG52YXIgTGlzdGVuZXIgPSAoZnVuY3Rpb24gKCkge1xyXG4gICAgdmFyIHBvcnRzLCBjb21wYW55O1xyXG4gICAgLy92YXIgc2F2ZSA9IHt9O1xyXG4gICAgdmFyIHNhdmUgPSBKU09OLnBhcnNlKG9yaVNhdmUucmVwbGFjZSgvJiMzNDsvZywgJ1xcXCInKS5yZXBsYWNlKC9cXFxcL2csICcnKS5yZXBsYWNlKC8mIzM5Oy9nLCBcIlxcJ1wiKSkgfHwge307XHJcblxyXG4gICAgdmFyIGxpc3RlbmVyID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIC8v5pyA5bCP6L6T5YWlMjAwXHJcbiAgICAgICAgJChkb2N1bWVudCkub24oJ2JsdXInLCAnI21pbi1wcmljZScsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgdmFyIHZhbCA9IHBhcnNlSW50KCQodGhpcykudmFsKCkpIHx8IDA7XHJcbiAgICAgICAgICAgIGlmICh2YWwgPCAyMDApIHtcclxuICAgICAgICAgICAgICAgICQodGhpcykudmFsKDIwMCk7XHJcbiAgICAgICAgICAgICAgICBNb2RhbC5zZXRBbGVydCgn5pyA5L2O5Lu35qC85LiN6IO95L2O5LqOMjAw77yBJyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgICAvL+WIoOmZpFxyXG4gICAgICAgICQoZG9jdW1lbnQpLm9uKCdjbGljaycsICcucmVtb3ZlLXRyJywgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICB2YXIga2V5ID0gJCh0aGlzKS5kYXRhKCdrZXknKTtcclxuICAgICAgICAgICAgJCh0aGlzKS5wYXJlbnRzKCd0cicpLnJlbW92ZSgpO1xyXG4gICAgICAgICAgICBkZWxldGUgc2F2ZVtrZXldO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIC8v5o+Q5LqkXHJcbiAgICAgICAgJChkb2N1bWVudCkub24oJ2NsaWNrJywgJyNlZGl0b3ItZW5zdXJlJywgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICB2YXIgZGF0YSA9IHtcclxuICAgICAgICAgICAgICAgIFwiY29tcGFueUlkXCI6IDAsXHJcbiAgICAgICAgICAgICAgICBcImFpckNvbXBhbnlDb2RlXCI6ICQoJyNpbm5lci1uYW1lJykuZGF0YSgnY29kZScpLFxyXG4gICAgICAgICAgICAgICAgXCJhaXJDb21wYW55TmFtZVwiOiAkKCcjaW5uZXItbmFtZScpLnZhbCgpLFxyXG4gICAgICAgICAgICAgICAgXCJhaXJDb21wYW55Q291bnRyeVwiOiAkKCcjY291bnRyeScpLnZhbCgpLFxyXG4gICAgICAgICAgICAgICAgXCJhaXJ3YXlCaWxsQ29kZVwiOiAkKCcjby1oZWFkZXInKS52YWwoKSxcclxuICAgICAgICAgICAgICAgIFwib2ZmaWNlQWRkcmVzc1wiOiAkKCcjYnNjZHonKS52YWwoKSxcclxuICAgICAgICAgICAgICAgIFwiQVdDX0ZlZVwiOiBwYXJzZUludCgkKCcjQVdDLXByaWNlJykudmFsKCkpLFxyXG4gICAgICAgICAgICAgICAgXCJDR0NfRmVlXCI6IHBhcnNlSW50KCQoJyNDR0MtcHJpY2UnKS52YWwoKSksXHJcbiAgICAgICAgICAgICAgICBcIm1pblByaWNlXCI6ICQoJyNtaW4tcHJpY2UnKS52YWwoKSxcclxuICAgICAgICAgICAgICAgIFwiYnVsa3lSYXRlXCI6ICQoJyNwZXJjZW50YWdlJykuZmluZCgnb3B0aW9uOnNlbGVjdGVkJykudmFsKCksXHJcbiAgICAgICAgICAgICAgICBcIndhcmVob3VzZUlkXCI6ICQoJyN3YXJlaG91c2UnKS5maW5kKCdvcHRpb246c2VsZWN0ZWQnKS52YWwoKSxcclxuICAgICAgICAgICAgICAgIFwidGVtcGxhdGVJZFwiOiAkKCcjcHJpY2UnKS5maW5kKCdvcHRpb246c2VsZWN0ZWQnKS52YWwoKSxcclxuICAgICAgICAgICAgICAgIFwiZGVwdEFpcnBvcnRzXCI6IFtdLFxyXG4gICAgICAgICAgICAgICAgXCJjb25maWdTdGF0ZVwiOiAxXHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIHZhciBkZXB0QWlycG9ydHMgPSBbXTtcclxuICAgICAgICAgICAgdmFyIGVsZSA9ICQoJy5pbm5lci10YicpLmZpbmQoJ3Rib2R5JykuZmluZCgndHInKTtcclxuICAgICAgICAgICAgZWxlLmVhY2goZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgZGVwdEFpcnBvcnRzLnB1c2goc2F2ZVskKHRoaXMpLmRhdGEoJ2tleScpXSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICBkYXRhWydkZXB0QWlycG9ydHMnXSA9IGRlcHRBaXJwb3J0cztcclxuICAgICAgICAgICAgaWYgKCQodGhpcykuZGF0YSgndHlwZScpID09IDEpIHtcclxuICAgICAgICAgICAgICAgIERhdGEuYWRkKGRhdGEsIGZ1bmN0aW9uIChqc29uKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGpzb24gJiYgJ3Jlc0NvZGUnIGluIGpzb24gJiYganNvbi5yZXNDb2RlID09IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgTW9kYWwuc2V0QWxlcnQoanNvbi5yZXNNc2cgfHwgJ+a3u+WKoOaIkOWKn++8gScsIG51bGwsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2F0aW9uLnJlbG9hZCgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBNb2RhbC5zZXRBbGVydChqc29uLnJlc01zZyB8fCAn5re75Yqg5aSx6LSl77yM6K+36YeN6K+V77yBJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBkYXRhWydJZCddID0gJCh0aGlzKS5kYXRhKCdpZCcpO1xyXG4gICAgICAgICAgICAgICAgRGF0YS51cGRhdGUoZGF0YSwgZnVuY3Rpb24gKGpzb24pIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoanNvbiAmJiAncmVzQ29kZScgaW4ganNvbiAmJiBqc29uLnJlc0NvZGUgPT0gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBNb2RhbC5zZXRBbGVydChqc29uLnJlc01zZyB8fCAn5L+u5pS55oiQ5Yqf77yBJywgbnVsbCwgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYXRpb24ucmVsb2FkKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIE1vZGFsLnNldEFsZXJ0KGpzb24ucmVzTXNnIHx8ICfkv67mlLnlpLHotKXvvIzor7fph43or5XvvIEnKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfTtcclxuICAgIHZhciBhaXJwb3J0cyA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAvL+iOt+WPluacuuWcuuWQjeensFxyXG4gICAgICAgICQoZG9jdW1lbnQpLm9uKCdrZXl1cCcsICdpbnB1dCNzdGFydCcsIGZ1bmN0aW9uIChlKSB7XHJcbiAgICAgICAgICAgIHZhciBjZCA9ICQoJyNpbm5lci1uYW1lJykuZGF0YSgnY29kZScpO1xyXG4gICAgICAgICAgICBpZiAoY2QgIT0gMCkge1xyXG4gICAgICAgICAgICAgICAgJCgnI2NvZGUnKS5yZW1vdmVDbGFzcygnd2FybScpO1xyXG4gICAgICAgICAgICAgICAgdmFyIF90aGlzID0gJCh0aGlzKVxyXG4gICAgICAgICAgICAgICAgICAgICwgdWwgPSBfdGhpcy5zaWJsaW5ncygnLmdldC1uYW1lJyk7XHJcbiAgICAgICAgICAgICAgICB2YXIgaW5kZXggPSB1bC5maW5kKCcuYWN0aXZlJykuaW5kZXgoKSB8fCAwXHJcbiAgICAgICAgICAgICAgICAgICAgLCBsZW4gPSB1bC5jaGlsZHJlbigpLmxlbmd0aDtcclxuICAgICAgICAgICAgICAgIHZhciBzdHIgPSAnJztcclxuICAgICAgICAgICAgICAgIGlmIChlLmtleUNvZGUgPT0gMTMpIHsvL+Wbnui9pumUrlxyXG4gICAgICAgICAgICAgICAgICAgIHZhciBkYXRhID0gdWwuY2hpbGRyZW4oJy5hY3RpdmUnKS5kYXRhKCd2YWwnKSB8fCB1bC5maW5kKCdsaTpmaXJzdC1jaGlsZCcpLmRhdGEoJ3ZhbCcpIHx8ICcnO1xyXG4gICAgICAgICAgICAgICAgICAgICQodGhpcykudmFsKCcnKTtcclxuICAgICAgICAgICAgICAgICAgICAkKHRoaXMpLmRhdGEoJ3ZhbCcsIGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChwb3J0cyAmJiBkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkKCcuYWRkLXRyW2RhdGEta2V5PVwiJyArIGRhdGEgKyAnXCJdJykubGVuZ3RoID09IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNhdmVbZGF0YV0gPSBwb3J0c1tkYXRhXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0ciA9ICc8dHIgY2xhc3M9XCJhZGQtdHJcIiBkYXRhLWtleT1cIicgKyBkYXRhICsgJ1wiPiA8dGQ+JyArIGRhdGEgKyAnPC90ZD4gPHRkPicgKyBwb3J0c1tkYXRhXS5kaXNwbGF5TmFtZSArICc8L3RkPiAnICtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnPHRkIGNsYXNzPVwiYmlnXCI+IDxkaXYgY2xhc3M9XCJkcC10YlwiPiAnICtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnIDxkaXYgY2xhc3M9XCJhZGRcIj4gPGRpdiBjbGFzcz1cInRvcFwiPiArIDwvZGl2PiA8YSBocmVmPVwiamF2YXNjcmlwdDp2b2lkKDApO1wiIGNsYXNzPVwiZHAtYlwiPua3u+WKoOaWh+S7tjwvYT4gJyArXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJzxpbnB1dCB0eXBlPVwiZmlsZVwiIGNsYXNzPVwidXAtZmlsZVwiIGRhdGEtcD1cIicgKyBkYXRhICsgJ1wiIGRhdGEtYz1cIicgKyAkKCcjaW5uZXItbmFtZScpLmRhdGEoJ2NvZGUnKSArICdcIj48L2Rpdj4gPC9kaXY+IDwvdGQ+JyArXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJzx0ZD48YSBocmVmPVwiamF2YXNjcmlwdDp2b2lkKDApO1wiIGNsYXNzPVwicmVtb3ZlLXRyXCIgZGF0YS1rZXk9XCInICsgZGF0YSArICdcIj7liKDpmaQ8L2E+PC90ZD4gPC90cj4nO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICQoJy5pbm5lci10YicpLmZpbmQoJ3Rib2R5JykuYXBwZW5kKHN0cik7XHJcbiAgICAgICAgICAgICAgICAgICAgdWwuaGlkZSgpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChlLmtleUNvZGUgPT0gMzgpIHsvL+S4iumUrlxyXG4gICAgICAgICAgICAgICAgICAgIGluZGV4ID0gaW5kZXggPT0gMCA/IGxlbiAtIDEgOiBpbmRleCAtIDE7XHJcbiAgICAgICAgICAgICAgICAgICAgdWwuZmluZCgnbGknKS5yZW1vdmVDbGFzcygnYWN0aXZlJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgdWwuZmluZCgnbGknKS5lcShpbmRleCkuYWRkQ2xhc3MoJ2FjdGl2ZScpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChlLmtleUNvZGUgPT0gNDApIHsvL+S4i+mUrlxyXG4gICAgICAgICAgICAgICAgICAgIGluZGV4ID0gaW5kZXggPT0gbGVuIC0gMSA/IDAgOiBpbmRleCArIDE7XHJcbiAgICAgICAgICAgICAgICAgICAgdWwuZmluZCgnbGknKS5yZW1vdmVDbGFzcygnYWN0aXZlJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgdWwuZmluZCgnbGknKS5lcShpbmRleCkuYWRkQ2xhc3MoJ2FjdGl2ZScpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHsvL+ato+W4uOi+k+WFpVxyXG4gICAgICAgICAgICAgICAgICAgIERhdGEuZ2V0TmFtZSh7a2V5OiBfdGhpcy52YWwoKX0sIGZ1bmN0aW9uIChqc29uKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChqc29uICYmICdyZXNCb2R5JyBpbiBqc29uICYmIGpzb24ucmVzQm9keSBpbnN0YW5jZW9mIEFycmF5ICYmIGpzb24ucmVzQm9keS5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgc3RyID0gJydcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAsIGJvZHkgPSBqc29uLnJlc0JvZHk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZHQgPSB7fTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGIgaW4gYm9keSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChib2R5Lmhhc093blByb3BlcnR5KGIpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBkID0gYm9keVtiXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RyICs9ICc8bGkgZGF0YS12YWw9XCInICsgZC5haXJwb3J0Q29kZSArICdcIiBjbGFzcz1cIicgKyAoYiA9PSAwID8gJ2FjdGl2ZScgOiAnJykgKyAnXCI+JyArIGQuZGlzcGxheU5hbWUgKyAnPC9saT4nO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkdFtkLmFpcnBvcnRDb2RlXSA9IGQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9ydHMgPSBkdDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVsLmh0bWwoc3RyKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVsLnNob3coKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgJCgnI2NvZGUnKS5hZGRDbGFzcygnd2FybScpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgLy9pbnB1dOWkseWOu+eEpueCuVxyXG4gICAgICAgICQoZG9jdW1lbnQpLm9uKCdibHVyJywgJ2lucHV0I3N0YXJ0JywgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICB2YXIgY2QgPSAkKCcjaW5uZXItbmFtZScpLmRhdGEoJ2NvZGUnKTtcclxuICAgICAgICAgICAgaWYgKGNkICE9IDApIHtcclxuICAgICAgICAgICAgICAgIHZhciB1bCA9ICQodGhpcykuc2libGluZ3MoJy5nZXQtbmFtZScpO1xyXG4gICAgICAgICAgICAgICAgdmFyIGRhdGEgPSB1bC5jaGlsZHJlbignLmFjdGl2ZScpLmRhdGEoJ3ZhbCcpIHx8IHVsLmZpbmQoJ2xpOmZpcnN0LWNoaWxkJykuZGF0YSgndmFsJykgfHwgJyc7XHJcbiAgICAgICAgICAgICAgICAkKHRoaXMpLnZhbChkYXRhKTtcclxuICAgICAgICAgICAgICAgICQodGhpcykuZGF0YSgndmFsJywgZGF0YSk7XHJcbiAgICAgICAgICAgICAgICB1bC5oaWRlKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgICAvL2xp5YWD57Sg5oKs5rWu6I635b6X54Sm54K5XHJcbiAgICAgICAgJChkb2N1bWVudCkub24oJ21vdXNlZW50ZXIgJywgJy5nZXQtbmFtZSBsaScsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgJCh0aGlzKS5hZGRDbGFzcygnYWN0aXZlJyk7XHJcbiAgICAgICAgICAgICQodGhpcykuc2libGluZ3MoKS5yZW1vdmVDbGFzcygnYWN0aXZlJyk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9O1xyXG4gICAgdmFyIGNvbXBhbnlzID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIC8v6I635Y+W6Iiq56m65YWs5Y+4XHJcbiAgICAgICAgJChkb2N1bWVudCkub24oJ2tleXVwJywgJ2lucHV0I2NvZGUnLCBmdW5jdGlvbiAoZSkge1xyXG4gICAgICAgICAgICB2YXIgX3RoaXMgPSAkKHRoaXMpXHJcbiAgICAgICAgICAgICAgICAsIHVsID0gX3RoaXMuc2libGluZ3MoJy5nZXQtbmFtZScpO1xyXG4gICAgICAgICAgICB2YXIgaW5kZXggPSB1bC5maW5kKCcuYWN0aXZlJykuaW5kZXgoKSB8fCAwXHJcbiAgICAgICAgICAgICAgICAsIGxlbiA9IHVsLmNoaWxkcmVuKCkubGVuZ3RoO1xyXG4gICAgICAgICAgICBpZiAoZS5rZXlDb2RlID09IDEzKSB7Ly/lm57ovabplK5cclxuICAgICAgICAgICAgICAgIHZhciBkYXRhID0gdWwuY2hpbGRyZW4oJy5hY3RpdmUnKS5kYXRhKCd2YWwnKSB8fCB1bC5maW5kKCdsaTpmaXJzdC1jaGlsZCcpLmRhdGEoJ3ZhbCcpIHx8ICcnO1xyXG4gICAgICAgICAgICAgICAgJCh0aGlzKS52YWwoZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAkKCcjaW5uZXItbmFtZScpLmRhdGEoJ2NvZGUnLCBkYXRhKTtcclxuICAgICAgICAgICAgICAgIGlmIChjb21wYW55ICYmIGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAkKCcjaW5uZXItbmFtZScpLnZhbChjb21wYW55W2RhdGFdLmNvbXBhbnlOYW1lIHx8ICcnKTtcclxuICAgICAgICAgICAgICAgICAgICAkKCcjY291bnRyeScpLnZhbChjb21wYW55W2RhdGFdLmNvbXBhbnlDb3VudHJ5IHx8ICcnKTtcclxuICAgICAgICAgICAgICAgICAgICAkKCcjby1oZWFkZXInKS52YWwoY29tcGFueVtkYXRhXS5haXJ3YXlCaWxsQ29kZSB8fCAnJyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB1bC5oaWRlKCk7XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoZS5rZXlDb2RlID09IDM4KSB7Ly/kuIrplK5cclxuICAgICAgICAgICAgICAgIGluZGV4ID0gaW5kZXggPT0gMCA/IGxlbiAtIDEgOiBpbmRleCAtIDE7XHJcbiAgICAgICAgICAgICAgICB1bC5maW5kKCdsaScpLnJlbW92ZUNsYXNzKCdhY3RpdmUnKTtcclxuICAgICAgICAgICAgICAgIHVsLmZpbmQoJ2xpJykuZXEoaW5kZXgpLmFkZENsYXNzKCdhY3RpdmUnKTtcclxuICAgICAgICAgICAgfSBlbHNlIGlmIChlLmtleUNvZGUgPT0gNDApIHsvL+S4i+mUrlxyXG4gICAgICAgICAgICAgICAgaW5kZXggPSBpbmRleCA9PSBsZW4gLSAxID8gMCA6IGluZGV4ICsgMTtcclxuICAgICAgICAgICAgICAgIHVsLmZpbmQoJ2xpJykucmVtb3ZlQ2xhc3MoJ2FjdGl2ZScpO1xyXG4gICAgICAgICAgICAgICAgdWwuZmluZCgnbGknKS5lcShpbmRleCkuYWRkQ2xhc3MoJ2FjdGl2ZScpO1xyXG4gICAgICAgICAgICB9IGVsc2Ugey8v5q2j5bi46L6T5YWlXHJcbiAgICAgICAgICAgICAgICBEYXRhLmdldENvZGUoe2tleTogX3RoaXMudmFsKCl9LCBmdW5jdGlvbiAoanNvbikge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChqc29uICYmICdyZXNCb2R5JyBpbiBqc29uICYmIGpzb24ucmVzQm9keSBpbnN0YW5jZW9mIEFycmF5ICYmIGpzb24ucmVzQm9keS5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBzdHIgPSAnJ1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLCBib2R5ID0ganNvbi5yZXNCb2R5O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgZHQgPSB7fTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgYiBpbiBib2R5KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYm9keS5oYXNPd25Qcm9wZXJ0eShiKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBkID0gYm9keVtiXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHIgKz0gJzxsaSBkYXRhLXZhbD1cIicgKyBkLmFpcmxpbmVDb2RlICsgJ1wiIGNsYXNzPVwiJyArIChiID09IDAgPyAnYWN0aXZlJyA6ICcnKSArICdcIj4nICsgZC5jb21wYW55TmFtZSArICc8L2xpPic7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZHRbZC5haXJsaW5lQ29kZV0gPSBkO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbXBhbnkgPSBkdDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdWwuaHRtbChzdHIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB1bC5zaG93KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdWwuaHRtbCgnJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgICAvL2lucHV05aSx5Y6754Sm54K5XHJcbiAgICAgICAgJChkb2N1bWVudCkub24oJ2JsdXInLCAnaW5wdXQjY29kZScsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgdmFyIHVsID0gJCh0aGlzKS5zaWJsaW5ncygnLmdldC1uYW1lJyk7XHJcbiAgICAgICAgICAgIGlmICh1bC5jaGlsZHJlbigpLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgICAgIHZhciBkYXRhID0gdWwuY2hpbGRyZW4oJy5hY3RpdmUnKS5kYXRhKCd2YWwnKSB8fCB1bC5maW5kKCdsaTpmaXJzdC1jaGlsZCcpLmRhdGEoJ3ZhbCcpIHx8ICcnO1xyXG4gICAgICAgICAgICAgICAgJCh0aGlzKS52YWwoZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAkKCcjaW5uZXItbmFtZScpLmRhdGEoJ2NvZGUnLCBkYXRhKTtcclxuICAgICAgICAgICAgICAgICQoJyNpbm5lci1uYW1lJykudmFsKGNvbXBhbnlbZGF0YV0uY29tcGFueU5hbWUgfHwgJycpO1xyXG4gICAgICAgICAgICAgICAgJCgnI2NvdW50cnknKS52YWwoY29tcGFueVtkYXRhXS5jb21wYW55Q291bnRyeSB8fCAnJyk7XHJcbiAgICAgICAgICAgICAgICAkKCcjby1oZWFkZXInKS52YWwoY29tcGFueVtkYXRhXS5haXJ3YXlCaWxsQ29kZSB8fCAnJyk7XHJcbiAgICAgICAgICAgICAgICB1bC5oaWRlKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH07XHJcbiAgICB2YXIgcHJpY2VJbml0ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIERhdGEucHJpY2VMaXN0KGZ1bmN0aW9uIChqc29uKSB7XHJcbiAgICAgICAgICAgIHZhciBzdHIgPSAnJztcclxuICAgICAgICAgICAgdmFyIGlkID0gJCgnI3ByaWNlJykuZGF0YSgnaWQnKTtcclxuICAgICAgICAgICAgaWYgKGpzb24gJiYgJ3Jlc0NvZGUnIGluIGpzb24gJiYganNvbi5yZXNDb2RlID09IDAgJiYgJ3NMaXN0JyBpbiBqc29uLnJlc0JvZHkgJiYganNvbi5yZXNCb2R5LnNMaXN0KSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgYXJyID0ganNvbi5yZXNCb2R5LnNMaXN0O1xyXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgYSBpbiBhcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoYXJyLmhhc093blByb3BlcnR5KGEpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBkID0gYXJyW2FdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzdHIgKz0gJzxvcHRpb24gdmFsdWU9XCInICsgZC50ZW1wbGF0ZUlkICsgJ1wiJyArIChkLnRlbXBsYXRlSWQgPT0gaWQgPyAnIHNlbGVjdGVkJyA6ICcnKSArICc+JyArIGQuZXhwZW5zZU5hbWUgKyAnPC9vcHRpb24+JztcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAkKCcjcHJpY2UnKS5odG1sKHN0cik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH07XHJcbiAgICB2YXIgd2FyZWhvdXNlSW5pdCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBEYXRhLndhcmVob3VzZShmdW5jdGlvbiAoanNvbikge1xyXG4gICAgICAgICAgICB2YXIgc3RyID0gJyc7XHJcbiAgICAgICAgICAgIHZhciBpZCA9ICQoJyN3YXJlaG91c2UnKS5kYXRhKCdpZCcpO1xyXG4gICAgICAgICAgICBpZiAoanNvbiAmJiAncmVzQ29kZScgaW4ganNvbiAmJiBqc29uLnJlc0NvZGUgPT0gMCAmJiAnc0xpc3QnIGluIGpzb24ucmVzQm9keSAmJiBqc29uLnJlc0JvZHkuc0xpc3QpIHtcclxuICAgICAgICAgICAgICAgIHZhciBhcnIgPSBqc29uLnJlc0JvZHkuc0xpc3Q7XHJcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBhIGluIGFycikge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChhcnIuaGFzT3duUHJvcGVydHkoYSkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGQgPSBhcnJbYV07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0ciArPSAnPG9wdGlvbiB2YWx1ZT1cIicgKyBkLndhcmVob3VzZUlkICsgJ1wiJyArIChkLndhcmVob3VzZUlkID09IGlkID8gJyBzZWxlY3RlZCcgOiAnJykgKyAnPicgKyBkLndhcmVob3VzZU5hbWUgKyAnPC9vcHRpb24+JztcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAkKCcjd2FyZWhvdXNlJykuaHRtbChzdHIpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9O1xyXG4gICAgdmFyIGZpbGVzID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICQoZG9jdW1lbnQpLm9uKCdjaGFuZ2UnLCAnLnVwLWZpbGUnLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHZhciBjZCA9ICQoJyNpbm5lci1uYW1lJykuZGF0YSgnY29kZScpO1xyXG4gICAgICAgICAgICBpZiAoY2QgIT0gMCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGFyciA9IFsnZG9jJywgJ2RvY3gnLCAncGRmJywgJ3hsc3gnLCAneGxzJ107XHJcbiAgICAgICAgICAgICAgICB2YXIgX3RoaXMgPSAkKHRoaXMpO1xyXG4gICAgICAgICAgICAgICAgdmFyIGZpbGUgPSB0aGlzLmZpbGVzWzBdXHJcbiAgICAgICAgICAgICAgICAgICAgLCBzaXplID0gdGhpcy5maWxlc1swXS5zaXplXHJcbiAgICAgICAgICAgICAgICAgICAgLCBuYW1lID0gdGhpcy5maWxlc1swXS5uYW1lO1xyXG4gICAgICAgICAgICAgICAgdmFyIG5hID0gbmFtZS5zcGxpdCgnLicpO1xyXG4gICAgICAgICAgICAgICAgaWYgKGFyci5pbmRleE9mKG5hW25hLmxlbmd0aCAtIDFdKSA+PSAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHNpemUgPCAyMDk3MTUyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIERhdGEudXAoe1wiZmlsZVwiOiBuYW1lfSwgZnVuY3Rpb24gKGpzb24pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0b2tlbjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChqc29uICYmICdyZXNDb2RlJyBpbiBqc29uICYmIGpzb24ucmVzQ29kZSA9PSAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9rZW4gPSBqc29uLnJlc0JvZHk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodG9rZW4pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBEYXRhLm9zc1VwbG9hZCh0b2tlbiwgZmlsZSwgZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGEgJiYgJ3N0YXR1cycgaW4gZGF0YSAmJiBkYXRhLnN0YXR1cyA+IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBkID0ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiZmlsZU5hbWVcIjogbmFtZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImZpbGVDb21tZW50XCI6ICcnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwia2V5TmFtZVwiOiB0b2tlbi5LZXluYW1lLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiYWdlbnRDb21wYW55SWRcIjogMCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImFpckNvbXBhbnlDb2RlXCI6ICQoJyNpbm5lci1uYW1lJykuZGF0YSgnY29kZScpLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiYWlycG9ydENvZGVcIjogX3RoaXMuZGF0YSgncCcpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRGF0YS5hZGRGaWxlKGQsIGZ1bmN0aW9uIChqc29uKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGpzb24gJiYgJ3Jlc0NvZGUnIGluIGpzb24gJiYganNvbi5yZXNDb2RlID09IDAgJiYganNvbi5yZXNCb2R5KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBkID0ganNvbi5yZXNCb2R5O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgc3RyID0gJzxkaXYgY2xhc3M9XCJmaWxlc1wiPiA8ZGl2IGNsYXNzPVwidG9wXCI+JyArIGQuZmlsZUV4dGVuc2lvbi50b1VwcGVyQ2FzZSgpICsgJzxzcGFuIGNsYXNzPVwiZ2x5cGhpY29uIGdseXBoaWNvbi10cmFzaFwiIGRhdGEta2V5PVwiJyArIGQua2V5TmFtZSArICdcIj48L3NwYW4+IDwvZGl2PiA8YSBocmVmPVwiamF2YXNjcmlwdDp2b2lkKDApO1wiIGNsYXNzPVwiZHAtYlwiPicgKyBkLmZpbGVOYW1lICsgJzwvYT4gPC9kaXY+JztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMucGFyZW50cygnLmFkZCcpLmJlZm9yZShzdHIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoX3RoaXMucGFyZW50cygnLmFkZCcpLnNpYmxpbmdzKCcuZmlsZXMnKS5sZW5ndGggPT0gMykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMucGFyZW50cygnLmFkZCcpLmhpZGUoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE1vZGFsLnNldEFsZXJ0KGpzb24ucmVzTXNnIHx8ICfkuIrkvKDlpLHotKXvvIEnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBNb2RhbC5zZXRBbGVydCgn5oKo5LiK5Lyg55qE5paH5Lu26LaF6L+HMk3vvIHor7fph43mlrDpgInmi6njgIInKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIE1vZGFsLnNldEFsZXJ0KCfmlofku7bmoLzlvI/mlK/mjIEuZG9jLy5kb2N4Ly54bHMvLnhsc3gvLnBkZi8nKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIE1vZGFsLnNldEFsZXJ0KCfor7flhYjpgInmi6noiKrnqbrlhazlj7jvvIEnKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgICQoZG9jdW1lbnQpLm9uKCdjbGljaycsICcuZ2x5cGhpY29uLXRyYXNoJywgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICB2YXIgX3RoaXMgPSAkKHRoaXMpO1xyXG4gICAgICAgICAgICB2YXIgZGF0YSA9IHtcclxuICAgICAgICAgICAgICAgIFwiYWdlbnRDb21wYW55SWRcIjogMCxcclxuICAgICAgICAgICAgICAgIFwia2V5TmFtZVwiOiAkKHRoaXMpLmRhdGEoJ2tleScpXHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIERhdGEuZGVsRmlsZShkYXRhLCBmdW5jdGlvbiAoanNvbikge1xyXG4gICAgICAgICAgICAgICAgaWYgKGpzb24gJiYgJ3Jlc0NvZGUnIGluIGpzb24gJiYganNvbi5yZXNDb2RlID09IDApIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoX3RoaXMucGFyZW50cygnLmZpbGVzJykuc2libGluZ3MoJy5maWxlcycpLmxlbmd0aCA9PSAyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLnBhcmVudHMoJy5maWxlcycpLnNpYmxpbmdzKCcuYWRkJykuc2hvdygpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBfdGhpcy5wYXJlbnRzKCcuZmlsZXMnKS5yZW1vdmUoKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgTW9kYWwuc2V0QWxlcnQoJ+WIoOmZpOWksei0pe+8gScpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9KTtcclxuICAgIH07XHJcbiAgICB2YXIgcnVuID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIGxpc3RlbmVyKCk7XHJcbiAgICAgICAgcHJpY2VJbml0KCk7XHJcbiAgICAgICAgd2FyZWhvdXNlSW5pdCgpO1xyXG4gICAgICAgIGZpbGVzKCk7XHJcbiAgICAgICAgY29tcGFueXMoKTtcclxuICAgICAgICBhaXJwb3J0cygpO1xyXG4gICAgfTtcclxuICAgIHJldHVybiB7XHJcbiAgICAgICAgcnVuOiBydW5cclxuICAgIH1cclxufSgpKTtcclxubW9kdWxlLmV4cG9ydHMuTGlzdGVuZXIgPSBMaXN0ZW5lcjsiLCIvKipcclxuICogQ3JlYXRlZCBieSB6cnogb24gMjAxNi8yLzI2LlxyXG4gKiBAdmVyc2lvbiAxLjAuMCBjcmVhdGVkIOmAmueUqOaAp+WKn+iDveaWueazlVxyXG4gKi9cclxuXHJcbid1c2Ugc3RyaWN0JztcclxuXHJcbnZhciBGdW4gPSAoZnVuY3Rpb24gKCkge1xyXG4gICAgdmFyIF90aW1lT3V0ID0gMTAwMDAwOy8v6K+35rGC6LaF5pe25pe26Ze05Li6MTBzXHJcbiAgICAvKipcclxuICAgICAqIOWwgeijhWFqYXhcclxuICAgICAqIEBwYXJhbSBvcHRpb25cclxuICAgICAqIHtcclxuICAgICAqICAgICAgdXJsOlwi6K+35rGC55qE5Zyw5Z2AXCJcclxuICAgICAqICAgICAgLG1ldGhvZDpcIuivt+axgueahOaWueazlVwiXHJcbiAgICAgKiAgICAgICxhc3luYzpcIuaYr+WQpuW5tuWPkVwiXHJcbiAgICAgKiAgICAgICxkYXRhOlwi5Y+R6YCB55qE5pWw5o2uXCJcclxuICAgICAqICAgICAgLHN1Y2Nlc3M6XCLmiJDlip/ml7blm57osINcIlxyXG4gICAgICogICAgICAsZXJyb3I6XCLlpLHotKUv6LaF5pe25pe25Zue6LCDXCJcclxuICAgICAqICAgICAgLHRpbWVvdXQ6XCLotoXml7bml7bpl7RcIlxyXG4gICAgICogICAgICAsY29tcGxldGU6XCLlrozmiJDlkI7nmoTlm57osINcIlxyXG4gICAgICogfVxyXG4gICAgICovXHJcbiAgICB2YXIgYWpheCA9IGZ1bmN0aW9uIChvcHRpb24pIHtcclxuICAgICAgICAvL2FqYXjlvIDlp4vml7blupTmmL7npLrigJzliqDovb3kv6Hmga/moYbigJ1cclxuICAgICAgICBNb2RhbC5zaG93TG9hZGluZygpO1xyXG4gICAgICAgICQuYWpheCh7XHJcbiAgICAgICAgICAgIHVybDogb3B0aW9uLnVybFxyXG4gICAgICAgICAgICAsIHR5cGU6IFwidHlwZVwiIGluIG9wdGlvbiAmJiBvcHRpb24udHlwZSB8fCBcIkdFVFwiXHJcbiAgICAgICAgICAgICwgdGltZW91dDogb3B0aW9uLnRpbWVvdXQgfHwgX3RpbWVPdXRcclxuICAgICAgICAgICAgLCBkYXRhOiBcImRhdGFcIiBpbiBvcHRpb24gJiYgb3B0aW9uLmRhdGEgfHwge31cclxuICAgICAgICAgICAgLCBkYXRhVHlwZTogXCJqc29uXCJcclxuICAgICAgICAgICAgLCBhc3luYzogKFwiYXN5bmNcIiBpbiBvcHRpb24gJiYgb3B0aW9uLmFzeW5jKSA/IHRydWUgOiBmYWxzZVxyXG4gICAgICAgICAgICAsIHN1Y2Nlc3M6IGZ1bmN0aW9uIChqc29uKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoXCJzdGF0dXNcIiBpbiBqc29uICYmIGpzb24uc3RhdHVzID4gMCAmJiBcImRhdGFcIiBpbiBqc29uKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKFwic3VjY2Vzc1wiIGluIG9wdGlvbikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBvcHRpb24uc3VjY2Vzcyhqc29uLmRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIE1vZGFsLnNldEFsZXJ0KFwi5pegc3VjY2Vzc+aWueazlSFcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChcImVycm9yXCIgaW4gb3B0aW9uICYmIG9wdGlvbi5lcnJvciBpbnN0YW5jZW9mIEZ1bmN0aW9uKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgb3B0aW9uLmVycm9yKGpzb24pO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBNb2RhbC5zZXRBbGVydCgn5pON5L2c5aSx6LSlIScpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9LCBlcnJvcjogZnVuY3Rpb24gKHhocikgey8vNDA05oiW6ICF6LaF5pe2XHJcbiAgICAgICAgICAgICAgICBpZiAoXCJlcnJvclwiIGluIG9wdGlvbiAmJiBvcHRpb24uZXJyb3IgaW5zdGFuY2VvZiBGdW5jdGlvbikge1xyXG4gICAgICAgICAgICAgICAgICAgIC8v5o+Q56S655So5oi36ZSZ6K+v5L+h5oGvXHJcbiAgICAgICAgICAgICAgICAgICAgTW9kYWwuc2hvd0xvYWRpbmcoZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgICAgIE1vZGFsLnNldEFsZXJ0KFwi6L+e5o6l5pyN5Yqh5Zmo5aSx6LSl77yM54q25oCB77yaXCIgKyAoeGhyLnN0YXR1cyB8fCAtMSkgKyBcIizkv6Hmga/vvJpcIiArICh4aHIuc3RhdHVzVGV4dCB8fCBcIi1cIikpO1xyXG4gICAgICAgICAgICAgICAgICAgIG9wdGlvbi5lcnJvcih4aHIuc3RhdHVzLCB4aHIuc3RhdHVzVGV4dCk7Ly/lm57osIPor7fmsYLnmoTnirbmgIHlkozplJnor6/kv6Hmga9cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSwgY29tcGxldGU6IGZ1bmN0aW9uICh4aHIsIHR5cGUpIHtcclxuICAgICAgICAgICAgICAgIC8v5YWz6Zet4oCc5Yqg6L295L+h5oGv5qGG4oCdXHJcbiAgICAgICAgICAgICAgICBNb2RhbC5zaG93TG9hZGluZyhmYWxzZSk7XHJcbiAgICAgICAgICAgICAgICBpZiAoXCJjb21wbGV0ZVwiIGluIG9wdGlvbiAmJiBvcHRpb24uY29tcGxldGUgaW5zdGFuY2VvZiBGdW5jdGlvbikge1xyXG4gICAgICAgICAgICAgICAgICAgIG9wdGlvbi5jb21wbGV0ZSh4aHIsIHR5cGUpOy8v5Zue6LCD6K+35rGC55qEeGhy5L+h5oGv5ZKM57G75Z6LXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH07XHJcbiAgICAvL+WFqOmAieWSjOWNlemAieeahOe7keWumlxyXG4gICAgdmFyIHNldENoZWNrYm94TGlzdGVuZXIgPSBmdW5jdGlvbiAoYWxsQ2hlY2ssIHJhZGlvQ2hlY2tzKSB7XHJcbiAgICAgICAgLy/nrZvpgInljZXpgInmjInpkq7nu4RcclxuICAgICAgICB2YXIgcmFkaW9WYWx1ZUVsZXMgPSAkKHJhZGlvQ2hlY2tzKTtcclxuICAgICAgICAvL+eCueWHu+WFqOmAieaXtu+8jOWQjOe7hOaMiemSruiiq+WQjOatpVxyXG4gICAgICAgICQoZG9jdW1lbnQpLmRlbGVnYXRlKGFsbENoZWNrLCBcImNsaWNrXCIsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgaWYgKHJhZGlvVmFsdWVFbGVzICYmIHJhZGlvVmFsdWVFbGVzLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgICAgIGZvciAodmFyIF9yID0gMDsgX3IgPCByYWRpb1ZhbHVlRWxlcy5sZW5ndGg7IF9yKyspIHtcclxuICAgICAgICAgICAgICAgICAgICByYWRpb1ZhbHVlRWxlc1tfcl0uY2hlY2tlZCA9ICQodGhpcykuaXMoXCI6Y2hlY2tlZFwiKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIC8v54K55Ye75Y2V6YCJ5oyJ6ZKu5pe277yMXHJcbiAgICAgICAgJChkb2N1bWVudCkuZGVsZWdhdGUocmFkaW9DaGVja3MsIFwiY2xpY2tcIiwgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAkKGFsbENoZWNrKVswXS5jaGVja2VkID0gJChyYWRpb0NoZWNrcyArIFwiOmNoZWNrZWRcIikubGVuZ3RoID09ICQocmFkaW9DaGVja3MpLmxlbmd0aDtcclxuICAgICAgICB9KTtcclxuICAgIH07XHJcbiAgICB2YXIgdXJsID0gKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB2YXIgZ2V0ID0gZnVuY3Rpb24gKG5hbWUpIHtcclxuICAgICAgICAgICAgdmFyIHJlZyA9IG5ldyBSZWdFeHAoXCIoXnwmKVwiICsgbmFtZSArIFwiPShbXiZdKikoJnwkKVwiLCBcImlcIik7XHJcbiAgICAgICAgICAgIHZhciByID0gd2luZG93LmxvY2F0aW9uLnNlYXJjaC5zdWJzdHIoMSkubWF0Y2gocmVnKTtcclxuICAgICAgICAgICAgaWYgKHIgIT0gbnVsbCkgcmV0dXJuIGRlY29kZVVSSShyWzJdKTtcclxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgfTtcclxuICAgICAgICAvKipcclxuICAgICAgICAgKiDmoLnmja7lj4LmlbDliJfooajplb/luqbov5vooYzliKTmlq3vvIzlhbzlrrlJRTlcclxuICAgICAgICAgKiBAcmV0dXJucyB7c3RyaW5nfVxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIHZhciBzZXQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIGlmIChhcmd1bWVudHMubGVuZ3RoID09PSAxICYmIHR5cGVvZiBhcmd1bWVudHNbMF0gPT09ICdvYmplY3QnKSB7Ly/kuIDkuKrlr7nosaHvvIzkvb/nlKhrZXnmoIforrB2YWx1ZVxyXG4gICAgICAgICAgICAgICAgdmFyIG9iaiA9IGFyZ3VtZW50c1swXVxyXG4gICAgICAgICAgICAgICAgICAgICwgc2VhcmNoID0gbG9jYXRpb24uc2VhcmNoO1xyXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgbyBpbiBvYmopIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAob2JqLmhhc093blByb3BlcnR5KG8pKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlYXJjaCA9IGNoYW5nZVVSTEtleVZhbHVlKHNlYXJjaCwgbywgb2JqW29dKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAoJ3B1c2hTdGF0ZScgaW4gaGlzdG9yeSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGhpc3RvcnkucHVzaFN0YXRlKG51bGwsIGRvY3VtZW50LnRpdGxlLCBzZWFyY2gpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmICgncHVzaFN0YXRlJyBpbiBIaXN0b3J5KSB7Ly9pZTkg5LiN5pSv5oyBcHVzaFN0YXRl5pa55rOVLGphdmFzY3JpcHQuZWpz5Lit5re75YqgaGlzdG9yeS5qc+WujOaIkGh0bWw05a+5cHVzaFN0YXRl55qE5pSv5oyBXHJcbiAgICAgICAgICAgICAgICAgICAgSGlzdG9yeS5wdXNoU3RhdGUobnVsbCwgbnVsbCwgc2VhcmNoKTsvL+i/lOWbnumHjeaWsOaehOmAoOWQjnNlYXJjaOS4slxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9IGVsc2UgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT09IDIpIHsvL2tleSt2YWx1ZVxyXG4gICAgICAgICAgICAgICAgdmFyIGtleSA9IGFyZ3VtZW50c1swXVxyXG4gICAgICAgICAgICAgICAgICAgICwgdmFsdWUgPSBhcmd1bWVudHNbMV07XHJcbiAgICAgICAgICAgICAgICBpZiAoJ3B1c2hTdGF0ZScgaW4gaGlzdG9yeSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGhpc3RvcnkucHVzaFN0YXRlKG51bGwsIGRvY3VtZW50LnRpdGxlLCBjaGFuZ2VVUkxLZXlWYWx1ZShsb2NhdGlvbi50b1N0cmluZygpLCBrZXksIHZhbHVlKSk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKCdwdXNoU3RhdGUnIGluIEhpc3RvcnkpIHsvL2llOSDkuI3mlK/mjIFwdXNoU3RhdGXmlrnms5UsamF2YXNjcmlwdC5lanPkuK3mt7vliqBoaXN0b3J5Lmpz5a6M5oiQaHRtbDTlr7lwdXNoU3RhdGXnmoTmlK/mjIFcclxuICAgICAgICAgICAgICAgICAgICBIaXN0b3J5LnB1c2hTdGF0ZShudWxsLCBudWxsLCBjaGFuZ2VVUkxLZXlWYWx1ZShsb2NhdGlvbi5zZWFyY2gsIGtleSwgdmFsdWUpKTsvL+i/lOWbnumHjeaWsOaehOmAoOWQjnNlYXJjaOS4slxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIGNoYW5nZVVSTEtleVZhbHVlKHVybCwgYXJnLCBhcmdfdmFsKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgcGF0dGVybiA9IGFyZyArICc9KFteJl0qKSc7XHJcbiAgICAgICAgICAgICAgICB2YXIgcmVwbGFjZVRleHQgPSBhcmcgKyAnPScgKyBhcmdfdmFsO1xyXG4gICAgICAgICAgICAgICAgaWYgKHVybC5tYXRjaChwYXR0ZXJuKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciB0bXAgPSAnLygnICsgYXJnICsgJz0pKFteJl0qKS9naSc7XHJcbiAgICAgICAgICAgICAgICAgICAgdG1wID0gdXJsLnJlcGxhY2UoZXZhbCh0bXApLCByZXBsYWNlVGV4dCk7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRtcDtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHVybC5tYXRjaCgnW1xcP10nKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdXJsICsgJyYnICsgcmVwbGFjZVRleHQ7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVybCArICc/JyArIHJlcGxhY2VUZXh0O1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgZ2V0OiBnZXRcclxuICAgICAgICAgICAgLCBzZXQ6IHNldFxyXG4gICAgICAgIH1cclxuICAgIH0oKSk7XHJcblxyXG4gICAgdmFyIGZvcm1hdEltYWdlPWZ1bmN0aW9uIChwYXRoLCBzaXplLCBlbGUpIHtcclxuICAgICAgICBpZihwYXRoIGluc3RhbmNlb2YgIEFycmF5ICYmIHBhdGgubGVuZ3RoPjApe1xyXG4gICAgICAgICAgICBwYXRoID0gcGF0aFswXTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdmFyIElNQUdFX1NJWkUgPSB7XHJcbiAgICAgICAgICAgIG9yaWdpbmFsOiB7XHJcbiAgICAgICAgICAgICAgICBwYXRoOiBcIlwiLFxyXG4gICAgICAgICAgICAgICAgc2l6ZTogXCJcIlxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICB4bGFyZ2U6IHtcclxuICAgICAgICAgICAgICAgIHBhdGg6IFwiX3hsYXJnZVwiLFxyXG4gICAgICAgICAgICAgICAgc2l6ZTogXCI2NjAqNjYwXCJcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgbGFyZ2U6IHtcclxuICAgICAgICAgICAgICAgIHBhdGg6IFwiX2xhcmdlXCIsXHJcbiAgICAgICAgICAgICAgICBzaXplOiBcIjQyMCo0MjBcIlxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBtaWRkbGU6IHtcclxuICAgICAgICAgICAgICAgIHBhdGg6IFwiX21pZGRsZVwiLFxyXG4gICAgICAgICAgICAgICAgc2l6ZTogXCIzMDAqMzAwXCJcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgc21hbGw6IHtcclxuICAgICAgICAgICAgICAgIHBhdGg6IFwiX3NtYWxsXCIsXHJcbiAgICAgICAgICAgICAgICBzaXplOiBcIjI0MCoyNDBcIlxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBsaXR0bGU6IHtcclxuICAgICAgICAgICAgICAgIHBhdGg6IFwiX2xpdHRsZVwiLFxyXG4gICAgICAgICAgICAgICAgc2l6ZTogXCIxMjAqMTIwXCJcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgbWljcm86IHtcclxuICAgICAgICAgICAgICAgIHBhdGg6IFwiX21pY3JvXCIsXHJcbiAgICAgICAgICAgICAgICBzaXplOiBcIjYwKjYwXCJcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICAgICAgc2l6ZSA9IElNQUdFX1NJWkVbc2l6ZSB8fCBcIm1pZGRsZVwiXSB8fCBJTUFHRV9TSVpFLm1pZGRsZTtcclxuICAgICAgICB2YXIgcGF0aFRlbXAgPSAvXFwuXFx3Kz8kLy5leGVjKHBhdGgpO1xyXG4gICAgICAgIGlmICghcGF0aFRlbXApIHtcclxuICAgICAgICAgICAgcGF0aCArPSBzaXplLnBhdGg7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgcGF0aCA9IChwYXRoLnN1YnN0cigwLCBwYXRoVGVtcC5pbmRleCB8fCBwYXRoLmxlbmd0aCkpICsgc2l6ZS5wYXRoICsgcGF0aFRlbXBbMF07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChlbGUgJiYgZWxlLmF0dHIpIHtcclxuICAgICAgICAgICAgZWxlLmF0dHIoXCJzcmNcIiwgcGF0aCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBwYXRoO1xyXG4gICAgfTtcclxuICAgIC8v6YeR6aKd5qC85byP5YyW5bCP5pWw54K5MuS9jVxyXG4gICAgdmFyIGZvcm1hdCA9IChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdmFyIGZvcm1hdGFtb3VudCA9IGZ1bmN0aW9uKF92YWx1ZSl7XHJcbiAgICAgICAgICAgIHJldHVybiBwYXJzZUZsb2F0KF92YWx1ZSkudG9GaXhlZCgyKTtcclxuICAgICAgICB9O1xyXG4gICAgICAgIC8v5L2T56ev5qC85byP5YyW5bCP5pWw54K5MuS9jVxyXG4gICAgICAgIHZhciBmb3JtYXR2b2x1bWUgPSBmdW5jdGlvbihfdmFsdWUpe1xyXG4gICAgICAgICAgICByZXR1cm4gcGFyc2VGbG9hdChfdmFsdWUpLnRvRml4ZWQoMyk7XHJcbiAgICAgICAgfTtcclxuICAgICAgICAvL+mHjemHj+agvOW8j+WMluWwj+aVsOeCuTLkvY1cclxuICAgICAgICB2YXIgZm9ybWF0d2VpZ2h0ID0gZnVuY3Rpb24oX3ZhbHVlKXtcclxuICAgICAgICAgICAgcmV0dXJuIHBhcnNlRmxvYXQoX3ZhbHVlKS50b0ZpeGVkKDMpO1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgZm9ybWF0YW1vdW50OiBmb3JtYXRhbW91bnRcclxuICAgICAgICAgICAgLCBmb3JtYXR2b2x1bWU6IGZvcm1hdHZvbHVtZVxyXG4gICAgICAgICAgICAsIGZvcm1hdHdlaWdodDogZm9ybWF0d2VpZ2h0XHJcbiAgICAgICAgfVxyXG4gICAgfSgpKTtcclxuICAgIHJldHVybiB7XHJcbiAgICAgICAgYWpheDogYWpheFxyXG4gICAgICAgICwgZ2V0VGltdG91dDogX3RpbWVPdXRcclxuICAgICAgICAsIHNldENoZWNrYm94TGlzdGVuZXI6IHNldENoZWNrYm94TGlzdGVuZXJcclxuICAgICAgICAsIHVybDogdXJsXHJcbiAgICAgICAgLCBmb3JtYXRJbWFnZTogZm9ybWF0SW1hZ2VcclxuICAgICAgICAsIGZvcm1hdDogZm9ybWF0XHJcbiAgICB9XHJcbn0oKSk7XHJcblxyXG5leHBvcnRzLmFqYXggPSBGdW4uYWpheDtcclxuZXhwb3J0cy5nZXRUaW1lb3V0ID0gRnVuLmdldFRpbXRvdXQ7XHJcbmV4cG9ydHMuc2V0Q2hlY2tib3hMaXN0ZW5lciA9IEZ1bi5zZXRDaGVja2JveExpc3RlbmVyO1xyXG5leHBvcnRzLnVybCA9IEZ1bi51cmw7XHJcbmV4cG9ydHMuZm9ybWF0SW1hZ2UgPSBGdW4uZm9ybWF0SW1hZ2U7XHJcbmV4cG9ydHMuZm9ybWF0ID0gRnVuLmZvcm1hdDtcclxuIiwiLyoqXHJcbiAqIENyZWF0ZWQgYnkgSmVyZW15IG9uIDIwMTcvMS8yMy5cclxuICovXHJcbid1c2Ugc3RyaWN0JztcclxudmFyIE1vZGFsID0gcmVxdWlyZSgnLi9tb2RhbCcpO1xyXG52YXIgZ2VuZXJhbCA9IChmdW5jdGlvbiAoKSB7XHJcbiAgICB2YXIgcnVuID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIC8v5pe26Ze05qC85byP5YyWXHJcbiAgICAgICAgRGF0ZS5wcm90b3R5cGUuRm9ybWF0ID0gZnVuY3Rpb24gKGZtdCkgeyAvL2F1dGhvcjogSmVyZW15eXlcclxuICAgICAgICAgICAgdmFyIG8gPSB7XHJcbiAgICAgICAgICAgICAgICBcIk0rXCI6IHRoaXMuZ2V0TW9udGgoKSArIDEsIC8v5pyI5Lu9XHJcbiAgICAgICAgICAgICAgICBcImQrXCI6IHRoaXMuZ2V0RGF0ZSgpLCAvL+aXpVxyXG4gICAgICAgICAgICAgICAgXCJoK1wiOiB0aGlzLmdldEhvdXJzKCksIC8v5bCP5pe2XHJcbiAgICAgICAgICAgICAgICBcIm0rXCI6IHRoaXMuZ2V0TWludXRlcygpLCAvL+WIhlxyXG4gICAgICAgICAgICAgICAgXCJzK1wiOiB0aGlzLmdldFNlY29uZHMoKSwgLy/np5JcclxuICAgICAgICAgICAgICAgIFwicStcIjogTWF0aC5mbG9vcigodGhpcy5nZXRNb250aCgpICsgMykgLyAzKSwgLy/lraPluqZcclxuICAgICAgICAgICAgICAgIFwiU1wiOiB0aGlzLmdldE1pbGxpc2Vjb25kcygpIC8v5q+r56eSXHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIGlmICgvKHkrKS8udGVzdChmbXQpKSBmbXQgPSBmbXQucmVwbGFjZShSZWdFeHAuJDEsICh0aGlzLmdldEZ1bGxZZWFyKCkgKyBcIlwiKS5zdWJzdHIoNCAtIFJlZ0V4cC4kMS5sZW5ndGgpKTtcclxuICAgICAgICAgICAgZm9yICh2YXIgayBpbiBvKVxyXG4gICAgICAgICAgICAgICAgaWYgKG5ldyBSZWdFeHAoXCIoXCIgKyBrICsgXCIpXCIpLnRlc3QoZm10KSkgZm10ID0gZm10LnJlcGxhY2UoUmVnRXhwLiQxLCAoUmVnRXhwLiQxLmxlbmd0aCA9PSAxKSA/IChvW2tdKSA6ICgoXCIwMFwiICsgb1trXSkuc3Vic3RyKChcIlwiICsgb1trXSkubGVuZ3RoKSkpO1xyXG4gICAgICAgICAgICByZXR1cm4gZm10O1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIC8v5L+u5pS55a+G56CBXHJcbiAgICAgICAgJChkb2N1bWVudCkub24oJ2NsaWNrJywgJyNjaGFuZ2UtcHdkJywgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAkKCcuY2hhbmdlLWJhY2snKS5yZW1vdmVDbGFzcygnZHAtbicpO1xyXG4gICAgICAgICAgICAkKCcuY2hhbmdlLXB3ZCcpLnJlbW92ZUNsYXNzKCdkcC1uJyk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgLy/lhbPpl63kv67mlLnlr4bnoIFcclxuICAgICAgICAkKGRvY3VtZW50KS5vbignY2xpY2snLCAnLmNsb3NlLXB3ZCcsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgJCgnLmNoYW5nZS1iYWNrJykuYWRkQ2xhc3MoJ2RwLW4nKTtcclxuICAgICAgICAgICAgJCgnLmNoYW5nZS1wd2QnKS5hZGRDbGFzcygnZHAtbicpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgICQoZG9jdW1lbnQpLm9uKCdjbGljaycsICcjZW5zdXJlLXB3ZCcsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgaWYgKCQoJyNuZXctcGFzc3dvcmQnKS52YWwoKSAhPSAkKCcjZW5zdXJlLXBhc3N3b3JkJykudmFsKCkpIHtcclxuICAgICAgICAgICAgICAgICQoJyNlbnN1cmUtcGFzc3dvcmQnKS5hZGRDbGFzcygnd2FybScpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgJCgnI2Vuc3VyZS1wYXNzd29yZCcpLnJlbW92ZUNsYXNzKCd3YXJtJyk7XHJcbiAgICAgICAgICAgICAgICB2YXIgZGF0YSA9IHtcclxuICAgICAgICAgICAgICAgICAgICBcImFnZW50TWVtYmVySWRcIjogMCxcclxuICAgICAgICAgICAgICAgICAgICBcIm9sZFB3ZFwiOiAkKCcjcGFzc3dvcmQnKS52YWwoKSxcclxuICAgICAgICAgICAgICAgICAgICBcInB3ZFwiOiAkKCcjbmV3LXBhc3N3b3JkJykudmFsKCksXHJcbiAgICAgICAgICAgICAgICAgICAgXCJwd2RDb25maXJtXCI6ICQoJyNlbnN1cmUtcGFzc3dvcmQnKS52YWwoKVxyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgICQuYWpheCh7XHJcbiAgICAgICAgICAgICAgICAgICAgdXJsOiAnL2FwaS9hY2NvdW50L2NoYW5nZVB3ZCdcclxuICAgICAgICAgICAgICAgICAgICAsIHR5cGU6ICdwb3N0J1xyXG4gICAgICAgICAgICAgICAgICAgICwgZGF0YTogZGF0YVxyXG4gICAgICAgICAgICAgICAgICAgICwgZGF0YVR5cGU6ICdqc29uJ1xyXG4gICAgICAgICAgICAgICAgICAgICwgdGltZW91dDogMTAwMDAwXHJcbiAgICAgICAgICAgICAgICAgICAgLCBzdWNjZXNzOiBmdW5jdGlvbiAoanNvbikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoanNvbiAmJiAncmVzQ29kZScgaW4ganNvbiAmJiBqc29uLnJlc0NvZGUgPT0gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgTW9kYWwuc2V0QWxlcnQoJ+S/ruaUueaIkOWKn++8gScsIG51bGwsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKCcuY2hhbmdlLWJhY2snKS5hZGRDbGFzcygnZHAtbicpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoJy5jaGFuZ2UtcHdkJykuYWRkQ2xhc3MoJ2RwLW4nKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgTW9kYWwuc2V0QWxlcnQoanNvbi5yZXNNc2cgfHwgJ+S/ruaUueWksei0pe+8jOivt+mHjeivle+8gScpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH07XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICAgIHJ1bjogcnVuXHJcbiAgICB9XHJcbn0oKSk7XHJcbm1vZHVsZS5leHBvcnRzLmdlbmVyYWwgPSBnZW5lcmFsOyIsIi8qKlxyXG4gKiBDcmVhdGVkIGJ5IHpyeiBvbiAyMDE2LzIvMjQuXHJcbiAqIEB2ZXJzaW9uIDEuMC4wIGNyZWF0ZWRcclxuICovXHJcblxyXG4ndXNlIHN0cmljdCc7XHJcblxyXG4vL+aehOmAoOS/oeaBr+ahhuS4u+S9k1xyXG52YXIgTW9kYWwgPSAoZnVuY3Rpb24gKCkge1xyXG4gICAgLy/mnoTpgKDljp/lp4vnsbtcclxuICAgIGZ1bmN0aW9uIE0obSkge1xyXG4gICAgICAgIHRoaXMucyA9IG0uczsvL+aYr+WQpuaYvuekulxyXG4gICAgICAgIHRoaXMuaWQgPSBtLmlkO1xyXG4gICAgfVxyXG5cclxuICAgIC8v5p6E6YCg5qCH5YeGc2hvd+aWueazle+8jOeUqOS6jue7p+aJv1xyXG4gICAgTS5wcm90b3R5cGUuc2hvdyA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB2YXIgZWxlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQodGhpcy5pZCk7XHJcbiAgICAgICAgaWYgKGVsZSkge1xyXG4gICAgICAgICAgICBpZiAodGhpcy5zICYmICFpc1Nob3coKSkgey8v5pi+56S65b2T5YmN6ZqQ6JePXHJcbiAgICAgICAgICAgICAgICBlbGUuY2xhc3NOYW1lID0gZWxlLmNsYXNzTmFtZS5yZXBsYWNlKFwiZHAtblwiLCBcIlwiKTtcclxuICAgICAgICAgICAgfSBlbHNlIGlmICghdGhpcy5zICYmIGlzU2hvdygpKSB7Ly/pmpDol4/lvZPliY3mmL7npLpcclxuICAgICAgICAgICAgICAgIGVsZS5jbGFzc05hbWUgKz0gXCIgZHAtblwiO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIC8v5Y676Zmk5Lik6L6555qE56m65qC8XHJcbiAgICAgICAgICAgIGVsZS5jbGFzc05hbWUgPSBTdHJpbmcoZWxlLmNsYXNzTmFtZSkudHJpbSgpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBmdW5jdGlvbiBpc1Nob3coKSB7Ly/mmK/lkKblt7LmmL7npLrvvIzml6BjbGFzc+aXtuaYvuekulxyXG4gICAgICAgICAgICByZXR1cm4gZWxlLmNsYXNzTmFtZS5zcGxpdChcImRwLW5cIikubGVuZ3RoID09IDE7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuXHJcbiAgICAvL+WKoOi9veS/oeaBr+ahhlxyXG4gICAgdmFyIGxvYWRpbmcgPSAoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIC8v5Yid5aeL5YyW55Sf5oiQ5Yqg6L295L+h5oGv5qGGXHJcbiAgICAgICAgdmFyIGluaXQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIGlmICghZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJsb2FkaW5nX21vZGFsX2VsZW1lbnRcIikpIHtcclxuICAgICAgICAgICAgICAgICQoJ2JvZHknKS5hcHBlbmQoJzxkaXYgaWQ9XCJsb2FkaW5nX21vZGFsX2VsZW1lbnRcIiBjbGFzcz1cImxvYWRpbmctbW9kYWwtYm9keSBkcC1uXCI+PGRpdiBjbGFzcz1cImNvdmVyX21vZGFsX2VsZW1lbnRcIj48L2Rpdj4nICtcclxuICAgICAgICAgICAgICAgICAgICAnPGRpdiBjbGFzcz1cImxvYWRpbmctbW9kYWwtaW1hZ2VcIj48L2Rpdj4nICtcclxuICAgICAgICAgICAgICAgICAgICAnPGRpdiBjbGFzcz1cImxvYWRpbmctbW9kYWwtdGV4dFwiPicgK1xyXG4gICAgICAgICAgICAgICAgICAgICc8aDI+546p5ZG95Yqg6L295Lit4oCm4oCmPC9oMj4nICtcclxuICAgICAgICAgICAgICAgICAgICAnPC9kaXY+PC9kaXY+Jyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgLy/mmL7npLrjgIHpmpDol4/kv6Hmga/moYZcclxuICAgICAgICB2YXIgc2hvdyA9IGZ1bmN0aW9uIChzKSB7XHJcbiAgICAgICAgICAgIHMgPSB0eXBlb2YgcyA9PSBcInVuZGVmaW5lZFwiID8gdHJ1ZSA6IHM7Ly/ml6Dlj4LmlbDmmL7npLrkv6Hmga/moYZcclxuICAgICAgICAgICAgdmFyIG0gPSBuZXcgTSh7aWQ6IFwibG9hZGluZ19tb2RhbF9lbGVtZW50XCIsIHM6IHN9KTtcclxuICAgICAgICAgICAgbS5zaG93KCk7XHJcbiAgICAgICAgfTtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBpbml0OiBpbml0XHJcbiAgICAgICAgICAgICwgc2hvdzogc2hvd1xyXG4gICAgICAgIH1cclxuICAgIH0oKSk7XHJcbiAgICAvL+W8ueWHuuS/oeaBr+ahhlxyXG4gICAgdmFyIGFsZXJ0ID0gKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB2YXIgaW5pdCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgaWYgKCFkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImFsZXJ0X21vZGFsX2VsZW1lbnRcIikpIHtcclxuICAgICAgICAgICAgICAgICQoJ2JvZHknKS5hcHBlbmQoJzxkaXYgaWQ9XCJhbGVydF9tb2RhbF9lbGVtZW50XCIgY2xhc3M9XCJhbGVydC1tb2RhbC1lbGVtZW50IGRwLW5cIj48ZGl2IGNsYXNzPVwiY292ZXJfbW9kYWxfZWxlbWVudFwiPjwvZGl2PicgK1xyXG4gICAgICAgICAgICAgICAgICAgICc8ZGl2IGNsYXNzPVwiYWxlcnQtbW9kYWwtY29udGVudFwiPicgK1xyXG4gICAgICAgICAgICAgICAgICAgICc8ZGl2IGNsYXNzPVwiYWxlcnQtbW9kYWwtYm9keVwiPjxzcGFuIGNsYXNzPVwiYWxlcnQtbW9kYWwtdGV4dFwiPjwvc3Bhbj48L2Rpdj4nICtcclxuICAgICAgICAgICAgICAgICAgICAnPGRpdiBjbGFzcz1cImFsZXJ0LW1vZGFsLWZvb3RlclwiPjxidXR0b24gaWQ9XCJhbGVydF9tb2RhbF9jbG9zZVwiIGNsYXNzPVwiYWxlcnQtbW9kYWwtYnV0dG9uXCI+5YWz6ZetPC9idXR0b24+PC9kaXY+JyArXHJcbiAgICAgICAgICAgICAgICAgICAgJzwvZGl2PjwvZGl2PicpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICB9O1xyXG4gICAgICAgIHZhciBzaG93ID0gZnVuY3Rpb24gKHMpIHtcclxuICAgICAgICAgICAgcyA9IHR5cGVvZiBzID09IFwidW5kZWZpbmVkXCIgPyB0cnVlIDogcztcclxuICAgICAgICAgICAgdmFyIG0gPSBuZXcgTSh7aWQ6IFwiYWxlcnRfbW9kYWxfZWxlbWVudFwiLCBzOiBzfSk7XHJcbiAgICAgICAgICAgIG0uc2hvdygpO1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICog6K6+572u5by55Ye65L+h5oGv5qGGXHJcbiAgICAgICAgICogQHBhcmFtIG1zZyAgICAgICDmmL7npLrnmoTkv6Hmga/vvIzmlK/mjIFodG1sXHJcbiAgICAgICAgICogQHBhcmFtIHNlZCAgICAgICDlgJLorqHml7blhbPpl63ml7bpl7TvvIzljZXkvY3vvJpzZWNvbmRcclxuICAgICAgICAgKiBAcGFyYW0gY2FsbGJhY2sgIOWFs+mXreinpuWPkeWbnuiwg+WHveaVsFxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIHZhciBzZXQgPSBmdW5jdGlvbiAobXNnLCBzZWQsIGNhbGxiYWNrKSB7XHJcbiAgICAgICAgICAgIHZhciBlbGUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImFsZXJ0X21vZGFsX2VsZW1lbnRcIik7XHJcbiAgICAgICAgICAgIGlmIChtc2cpIHtcclxuICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgbXNnID09PSAnb2JqZWN0Jykgey8v5bqU5a+55ZCO56uv6L+U5Zue5o+Q56S65pe25L2/55SoT2JqZWN05bCB6KOFXHJcbiAgICAgICAgICAgICAgICAgICAgbXNnID0gSlNPTi5zdHJpbmdpZnkobXNnKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmKGVsZSl7XHJcbiAgICAgICAgICAgICAgICAgICAgZWxlLmdldEVsZW1lbnRzQnlDbGFzc05hbWUoXCJhbGVydC1tb2RhbC10ZXh0XCIpWzBdLmlubmVySFRNTCA9IG1zZztcclxuICAgICAgICAgICAgICAgIH1lbHNle1xyXG4gICAgICAgICAgICAgICAgICAgIGluaXQoKTtcclxuICAgICAgICAgICAgICAgICAgICBlbGUuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZShcImFsZXJ0LW1vZGFsLXRleHRcIilbMF0uaW5uZXJIVE1MID0gbXNnO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgc2hvdygpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChzZWQgPiAwKSB7XHJcbiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICBzaG93KGZhbHNlKTtcclxuICAgICAgICAgICAgICAgIH0sIDEwMDAgKiBzZWQpO1xyXG4gICAgICAgICAgICB9Ly/ml6DlhbPpl63ml7bpl7TmiJbogIXlhbPpl63ml7bpl7TkuLow77yM5LiN6Ieq5Yqo5YWz6ZetXHJcbiAgICAgICAgICAgIC8vZml4bWUg5LqL5Lu255uR5ZCs55qEaWXlhbzlrrnmgKdcclxuICAgICAgICAgICAgLy/lhbPpl63mjInpkq7nmoTkuovku7bkvqblkKxcclxuICAgICAgICAgICAgJChcIiNhbGVydF9tb2RhbF9jbG9zZVwiKS5vbihcImNsaWNrXCIsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIGlmIChjYWxsYmFjayAmJiBjYWxsYmFjayBpbnN0YW5jZW9mIEZ1bmN0aW9uKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHNob3coZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgLy/pmLvmraLkuovku7bnu6fnu63kvKDpgJJcclxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBpbml0OiBpbml0XHJcbiAgICAgICAgICAgICwgc2hvdzogc2hvd1xyXG4gICAgICAgICAgICAsIHNldDogc2V0XHJcbiAgICAgICAgfVxyXG4gICAgfSgpKTtcclxuICAgIC8v6YCJ5oup5L+h5oGv5qGGXHJcbiAgICB2YXIgY29uZmlybSA9IChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdmFyIGluaXQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIGlmICghZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJjb25maXJtX21vZGFsX2VsZW1lbnRcIikpIHtcclxuICAgICAgICAgICAgICAgICQoJ2JvZHknKS5hcHBlbmQoJzxkaXYgaWQ9XCJjb25maXJtX21vZGFsX2VsZW1lbnRcIiBjbGFzcz1cImNvbmZpcm0tbW9kYWwtZWxlbWVudCBkcC1uXCI+PGRpdiBjbGFzcz1cImNvdmVyX21vZGFsX2VsZW1lbnRcIj48L2Rpdj4nICtcclxuICAgICAgICAgICAgICAgICAgICAnPGRpdiBjbGFzcz1cImNvbmZpcm0tbW9kYWwtY29udGVudFwiPicgK1xyXG4gICAgICAgICAgICAgICAgICAgICc8ZGl2IGlkPVwiY29uZmlybV9tb2RhbF9oZWFkZXJcIiBjbGFzcz1cImNvbmZpcm0tbW9kYWwtaGVhZGVyIGRwLW5cIj48L2Rpdj4nICtcclxuICAgICAgICAgICAgICAgICAgICAnPGRpdiBjbGFzcz1cImNvbmZpcm0tbW9kYWwtYm9keVwiPjxzcGFuIGlkPVwiY29uZmlybV9tb2RhbF90ZXh0XCIgY2xhc3M9XCJjb25maXJtLW1vZGFsLXRleHRcIj48L3NwYW4+PC9kaXY+JyArXHJcbiAgICAgICAgICAgICAgICAgICAgJzxkaXYgY2xhc3M9XCJjb25maXJtLW1vZGFsLWZvb3RlclwiPicgK1xyXG4gICAgICAgICAgICAgICAgICAgICc8ZGl2IGNsYXNzPVwiZm9vdGVyLWJ1dHRvbi1zdWNjZXNzXCI+PGJ1dHRvbiBjbGFzcz1cImNvbmZpcm0tbW9kYWwtYnV0dG9uICBtb2RhbC1zdWNjZXNzXCIgZGF0YS1jb25maXJtPVwic3VjY2Vzc1wiPuehruiupDwvYnV0dG9uPjwvZGl2PicgK1xyXG4gICAgICAgICAgICAgICAgICAgICc8ZGl2IGNsYXNzPVwiZm9vdGVyLWJ1dHRvbi1mYWxzZVwiPjxidXR0b24gY2xhc3M9XCJjb25maXJtLW1vZGFsLWJ1dHRvblwiIGRhdGEtY29uZmlybT1cImVycm9yXCI+5Y+W5raIPC9idXR0b24+PC9kaXY+JyArXHJcbiAgICAgICAgICAgICAgICAgICAgJzwvZGl2PjwvZGl2PjwvZGl2PicpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICB9O1xyXG4gICAgICAgIHZhciBzaG93ID0gZnVuY3Rpb24gKHMpIHtcclxuICAgICAgICAgICAgcyA9IHR5cGVvZiBzID09IFwidW5kZWZpbmVkXCIgPyB0cnVlIDogcztcclxuICAgICAgICAgICAgdmFyIG0gPSBuZXcgTSh7aWQ6IFwiY29uZmlybV9tb2RhbF9lbGVtZW50XCIsIHM6IHN9KTtcclxuICAgICAgICAgICAgbS5zaG93KCk7XHJcbiAgICAgICAgfTtcclxuICAgICAgICAvKipcclxuICAgICAgICAgKiDorr7nva7pgInmi6nkv6Hmga/moYbnmoTlhoXlrrlcclxuICAgICAgICAgKiBAcGFyYW0gb3B0aW9uICAgIOmFjee9rlxyXG4gICAgICAgICAqIHtcclxuICAgICAgICAgKiAgICAgIHRpdGxlOlwi5aS06YOo5pi+56S655qE5L+h5oGvXCJcclxuICAgICAgICAgKiAgICAgICx0ZXh0Olwi5pi+56S655qE5o+Q56S65L+h5oGvXCJcclxuICAgICAgICAgKiAgICAgICxzdWNjZXNzOlwi54K55Ye75oiQ5Yqf5ZCO55qE5Zue6LCDXCJcclxuICAgICAgICAgKiAgICAgICxlcnJvcjpcIueCueWHu+Wksei0peWQjueahOWbnuiwg1wiXHJcbiAgICAgICAgICogICAgICAsY29tcGxldGU6XCLngrnlh7vmjInpkq7lkI7nmoTmlbTkvZPlm57osINcIlxyXG4gICAgICAgICAqIH1cclxuICAgICAgICAgKi9cclxuICAgICAgICB2YXIgYmFyID0gMDtcclxuICAgICAgICB2YXIgc2V0ID0gZnVuY3Rpb24gKG9wdGlvbikge1xyXG4gICAgICAgICAgICBpZiAoIW9wdGlvbikge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChcInRpdGxlXCIgaW4gb3B0aW9uICYmIG9wdGlvbi50aXRsZS5sZW5ndGggPiAwKSB7Ly/mnInlpLTpg6jvvIzliJnmmL7npLrlpLTpg6hcclxuICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiY29uZmlybV9tb2RhbF9oZWFkZXJcIikuaW5uZXJIVE1MID0gb3B0aW9uLnRpdGxlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChcInRleHRcIiBpbiBvcHRpb24gJiYgb3B0aW9uLnRleHQubGVuZ3RoID4gMCkgey8v5pyJ5YaF5a6577yM5YiZ5pi+56S65pW05Liq6YCJ5oup5L+h5oGv5qGGXHJcbiAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImNvbmZpcm1fbW9kYWxfdGV4dFwiKS5pbm5lckhUTUwgPSBvcHRpb24udGV4dDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAvL2ZpeG1lIOS6i+S7tuebkeWQrOeahGll5YW85a655oCnXHJcbiAgICAgICAgICAgIC8v5YWz6Zet5oyJ6ZKu55qE5LqL5Lu25L6m5ZCsXHJcbiAgICAgICAgICAgICQoXCIjY29uZmlybV9tb2RhbF9lbGVtZW50XCIpLmZpbmQoXCIuY29uZmlybS1tb2RhbC1idXR0b25cIikub2ZmKFwiY2xpY2tcIikub24oXCJjbGlja1wiLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAvL2ZpeG1lIC5vZmYoXCJjbGlja1wiKeeUqOS6jumYsuatouWkmuasoeinpuWPkTwtLeW+iOeOhOWtpu+8jOaIkeS5n+S4jeefpemBk+S4uuS7gOS5iO+8jOS9huaYr+ivt+S4jeimgeS/ruaUueOAglxyXG4gICAgICAgICAgICAgICAgdmFyIGF0ciA9ICQodGhpcykuYXR0cihcImRhdGEtY29uZmlybVwiKTsvL+mAieaLqeeahOaMiemSrlxyXG4gICAgICAgICAgICAgICAgYmFyKys7XHJcbiAgICAgICAgICAgICAgICBpZiAob3B0aW9uICYmIGF0ciBpbiBvcHRpb24gJiYgb3B0aW9uW2F0cl0gaW5zdGFuY2VvZiBGdW5jdGlvbikge1xyXG4gICAgICAgICAgICAgICAgICAgIG9wdGlvblthdHJdKCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAob3B0aW9uICYmIFwiY29tcGxldGVcIiBpbiBvcHRpb24gJiYgb3B0aW9uLmNvbXBsZXRlIGluc3RhbmNlb2YgRnVuY3Rpb24pIHtcclxuICAgICAgICAgICAgICAgICAgICBvcHRpb24uY29tcGxldGUoKTsvL+iLpeacieWujOaIkOWHveaVsO+8jOWImeaJp+ihjFxyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHsvL+WQpuWIme+8jOWFs+mXremAieaLqeahhlxyXG4gICAgICAgICAgICAgICAgICAgIHNob3coZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgLy/pmLvmraLkuovku7bnu6fnu63kvKDpgJJcclxuICAgICAgICAgICAgICAgIC8vcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIGluaXQ6IGluaXRcclxuICAgICAgICAgICAgLCBzaG93OiBzaG93XHJcbiAgICAgICAgICAgICwgc2V0OiBzZXRcclxuICAgICAgICB9XHJcbiAgICB9KCkpO1xyXG4gICAgLy/opobnm5blsYJcclxuICAgIHZhciBjb3ZlciA9IChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdmFyIGluaXQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIGlmICghZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJjb3Zlcl9tb2RhbF9lbGVtZW50XCIpKSB7XHJcbiAgICAgICAgICAgICAgICAkKCdib2R5JykuYXBwZW5kKCc8ZGl2IGlkPVwiY292ZXJfbW9kYWxfZWxlbWVudFwiIGNsYXNzPVwiY292ZXItbW9kYWwtZWxlbWVudCBkcC1uXCI+PC9kaXY+Jyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgdmFyIGhpZGUgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiY292ZXJfbW9kYWxfZWxlbWVudFwiKS5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XHJcbiAgICAgICAgfTtcclxuICAgICAgICB2YXIgc2hvdyA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJjb3Zlcl9tb2RhbF9lbGVtZW50XCIpLnN0eWxlLmRpc3BsYXkgPSBcImJsb2NrXCI7XHJcbiAgICAgICAgfTtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBpbml0OiBpbml0XHJcbiAgICAgICAgICAgICwgc2hvdzogc2hvd1xyXG4gICAgICAgICAgICAsIGhpZGU6IGhpZGVcclxuICAgICAgICB9XHJcbiAgICB9KCkpO1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgICBpbml0TG9hZGluZzogbG9hZGluZy5pbml0XHJcbiAgICAgICAgLCBzaG93TG9hZGluZzogbG9hZGluZy5zaG93XHJcblxyXG4gICAgICAgICwgaW5pdEFsZXJ0OiBhbGVydC5pbml0XHJcbiAgICAgICAgLCBzaG93QWxlcnQ6IGFsZXJ0LnNob3dcclxuICAgICAgICAsIHNldEFsZXJ0OiBhbGVydC5zZXRcclxuXHJcbiAgICAgICAgLCBpbml0Q29uZmlybTogY29uZmlybS5pbml0XHJcbiAgICAgICAgLCBzZXRDb25maXJtOiBjb25maXJtLnNldFxyXG4gICAgICAgICwgc2hvd0NvbmZpcm06IGNvbmZpcm0uc2hvd1xyXG4gICAgICAgICwgaW5pdENvdmVyOiBjb3Zlci5pbml0XHJcbiAgICB9XHJcbn0oKSk7XHJcblxyXG4vL+mhtemdouWKoOi9veWujOavleWQjueUn+aIkOWbm+S4quiHquWumuS5ieaooeaAgeahhlxyXG5zZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcclxuICAgIC8v6aG16Z2i5Yqg6L295pe255Sf5oiQ5LiA5Liq6KaG55uW5bGCXHJcbiAgICBNb2RhbC5pbml0Q292ZXIoKTtcclxuICAgIC8v6aG16Z2i5Yqg6L295pe255Sf5oiQ5LiA5Liq5Yqg6L295L+h5oGv5qGGXHJcbiAgICBNb2RhbC5pbml0TG9hZGluZygpO1xyXG4gICAgLy/pobXpnaLliqDovb3ml7bnlJ/miJDkuIDkuKrlvLnlh7rkv6Hmga/moYZcclxuICAgIE1vZGFsLmluaXRBbGVydCgpO1xyXG4gICAgLy/pobXpnaLliqDovb3ml7bnlJ/miJDkuIDkuKrpgInmi6nkv6Hmga/moYZcclxuICAgIE1vZGFsLmluaXRDb25maXJtKCk7XHJcbn0sIDEwMCk7XHJcblxyXG5cclxuLy/mipvlh7rkuIrlsYLosIPnlKhcclxuZXhwb3J0cy5zaG93TG9hZGluZyA9IE1vZGFsLnNob3dMb2FkaW5nO1xyXG5leHBvcnRzLnNldEFsZXJ0ID0gTW9kYWwuc2V0QWxlcnQ7XHJcbmV4cG9ydHMuc2hvd0FsZXJ0ID0gTW9kYWwuc2hvd0FsZXJ0O1xyXG5leHBvcnRzLnNldENvbmZpcm0gPSBNb2RhbC5zZXRDb25maXJtO1xyXG5leHBvcnRzLnNob3dDb25maXJtID0gTW9kYWwuc2hvd0NvbmZpcm07Il19
